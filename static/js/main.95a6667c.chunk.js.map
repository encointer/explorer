{"version":3,"sources":["config/index.js","substrate-lib/SubstrateContext.js","substrate-lib/useSubstrate.js","substrate-lib/utils.js","substrate-lib/components/DeveloperConsole.js","map/MapMenu.js","map/CeremonyPhaseTimer.jsx","map/MapCeremonyPhases.jsx","map/MapNodeInfo.js","map/MapControl.js","utils.js","map/MapSidebar.js","map/MapNodeSwitchWidget.js","map/MarkerIcon.js","map/CommunitiesClusters.js","map/LocationsLayer.js","Map.js","App.js","index.js"],"names":["configEnv","require","envVars","reduce","mem","n","undefined","process","slice","config","configCommon","connectedSocket","queryString","parse","window","location","search","rpc","PROVIDER_SOCKET","console","log","INIT_STATE","socket","keyring","keyringState","api","apiState","reducer","state","action","type","payload","Error","SubstrateContext","React","createContext","SubstrateContextProvider","props","initState","forEach","key","useReducer","dispatch","Provider","value","children","useSubstrate","useContext","types","connect","useCallback","a","provider","WsProvider","ApiPromise","options","_api","on","isReady","then","useEffect","toFormat","BigJS","DeveloperConsole","util","util_crypto","memo","Sidebar","as","Menu","animation","direction","icon","inverted","vertical","visible","width","Item","href","target","Icon","name","prev","cur","phaseTimestampToTimer","timestamp","timeSec","Date","now","seconds","minutes","hours","days","daysStr","toString","concat","hoursStr","padStart","minutesStr","secondsStr","CeremonyPhaseTimer","nextPhaseTimestamp","useState","timer","setTimer","id","setInterval","clearInterval","Fragment","ceremonyPhases","formatStartingAt","toLocaleString","formatDate","small","participantCount","meetupCount","attestationCount","currentPhase","phase","counter","className","Step","Group","ordered","unstackable","join","size","phasesProps","map","idx","active","toLowerCase","filter","prop","reverse","phasesSteps","Content","Title","Label","circular","color","Description","newProp","oldProp","Blocks","blockNumber","setBlockNumber","bestNumber","derive","chain","finalized","bestNumberFinalized","unsubscribeAll","toNumber","unsub","catch","error","_","CeremonyIndex","getCurrentCeremonyIndex","query","encointerScheduler","currentCeremonyIndex","setCurrentCeremonyIndex","newCeremonyIndex","MapNodeInfoMain","onClickNode","nodeInfo","setNodeInfo","system","Promise","all","version","nodeName","nodeVersion","getInfo","Card","style","onClick","Header","Meta","Loader","inline","MapNodeInfo","loading","onZoomIn","onZoomOut","stackable","Button","disabled","compact","parserFixPoint","upper","lower","len","assert","raw","precision","bitLength","bits","lowerBits","length","floatPart","split","acc","bit","upperBits","decimalPart","parseInt","negative","parseI64F64","mapReduce","arr","mapperFn","reducerFn","result","batchFetch","apiMethod","ids","it","responses","BigFormat","Big","MapSidebarMain","debug","onClose","onShow","hash","lastParticipantCount","lastMeetupCount","data","cid","demurrage","demurragePerBlock","ref","useRef","isVertical","bootstrappers","setBootstrappers","entry","setEntry","currentBlock","setCurrentBlock","moneySupply","setMoneySupply","encointerCommunities","toJSON","encointerBalances","totalIssuance","principal","get","lastUpdate","applyDemurrage","Math","exp","Segment","current","padded","textAlign","sub","Message","horizontal","toFixed","isNaN","stacked","List","content","labelPosition","getCustomEndpoints","storedAsset","localStorage","getItem","JSON","e","createEndpoints","isHeader","text","info","isDevelopment","item","isDisabled","combineEndpoints","endpoints","push","header","networks","prov","url","providers","isChild","Url","apiUrl","label","setApiUrl","_setApiUrl","Radio","onChange","checked","Network","isSelected","useMemo","some","_selectFirst","alt","src","GroupDisplay","index","setGroup","_setGroup","network","Endpoints","linkOptions","groups","setGroups","extractUrlState","groupIndex","findIndex","hasUrlChanged","isUrlValid","startsWith","storedCustomEndpoints","setStoredCustomEndpoints","isSavedCustomEndpoint","endpoint","_changeGroup","_removeApiEndpoint","newStoredCurstomEndpoints","setItem","stringify","_onChangeCustom","_onApply","assign","origin","pathname","encodeURIComponent","_saveApiEndpoint","position","group","Input","positive","fluid","DivIcon","L","markerClassName","clusterClassName","iconSize","count","html","communityIcon","clusterIcon","iconActive","iconActivePulse","iconSemiactivePulse","iconSemiactive","iconInactive","locationMarker","iconUrl","shadowUrl","iconAnchor","popupAnchor","shadowSize","getClusterIcon","iconSet","green","yellow","red","getIcon","iconClass","createClusterCustomIcon","cluster","markers","getAllChildMarkers","markerCount","getChildCount","initialState","timers","byCID","tid","clearTimeout","CommunitiesClusters","cids","selected","subscribtionPhase","counters","attestations","meetups","attests","marker","newMarkers","setTimeout","leafletElement","refreshClusters","sourceTarget","iconCreateFunction","chunkedLoading","Marker","Tooltip","offset","attest","timeout","LocationsLayer","coords","pos","initialPosition","parseLatLng","toLatLng","lat","lon","parseDemurrage","tileSetup","attribution","apiReady","queryName","queryMulti","sumUp","obj","Object","keys","subscribtionCeremony","lastCeremony","participants","subscribtions","setters","Map","mapRef","menu","nodeSwitch","ui","setUI","setCids","setHash","setData","setPosition","setCurrentPhase","ceremonyIndex","setCeremonyIndex","ec","encointerCurrencies","kvReducer","fetcher","communityMetadata","currencyProperties","locations","properties","getCenter","demurrage_per_block","name_utf8","u8aToString","handlerZoom","s","getCurrentPhase","getNextPhaseTimestamp","newPhase","newPhaseTimestamp","unsubscribe","CommunityCeremony","registry","getOrUnknown","fetchHistoricData","ceremony","encointerCeremonies","getParticipantCount","getMeetupCount","oldPhase","communityCeremony","getter","bs58","fetchLastCeremony","U32","lastCeremonyData","subscribeToUpdates","ceremonyNumber","getAttestationCount","getters","unsubs","communityIdentifiers","currencyIdentifiers","hashes","err","fetchGeodataPar","locate","invalidateSize","sidebarSize","Responsive","fireOnMount","onUpdate","portrait","onlyMobile","maxWidth","Pushable","MapMenu","setZoom","prevZoom","Pusher","marginRight","display","center","zoom","zoomControl","touchZoom","height","container","offsetHeight","calcMapOffset","onLocationFound","latlng","flyTo","TileLayer","getZoom","bounds","pad","fitBounds","Main","App","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.95a6667c.chunk.js","sourcesContent":["import configCommon from './common.json';\n// Using `require` as `import` does not support dynamic loading (yet).\nconst configEnv = require(`./${process.env.NODE_ENV}.json`);\n\n// Accepting React env vars and aggregating them into `config` object.\nconst envVarNames = [\n  'REACT_APP_PROVIDER_SOCKET',\n  'REACT_APP_DEVELOPMENT_KEYRING'\n];\nconst envVars = envVarNames.reduce((mem, n) => {\n  // Remove the `REACT_APP_` prefix\n  if (process.env[n] !== undefined) mem[n.slice(10)] = process.env[n];\n  return mem;\n}, {});\n\nconst config = { ...configCommon, ...configEnv, ...envVars };\nexport default config;\n","import React, { useReducer } from 'react';\nimport PropTypes from 'prop-types';\nimport queryString from 'query-string';\nimport config from '../config';\n\nconst parsedQuery = queryString.parse(window.location.search);\nconst connectedSocket = parsedQuery.rpc || config.PROVIDER_SOCKET;\nconsole.log(`Connected socket: ${connectedSocket}`);\n\nconst INIT_STATE = {\n  socket: connectedSocket,\n  keyring: null,\n  keyringState: null,\n  api: null,\n  apiState: null\n};\n\nconst reducer = (state, action) => {\n  let socket = null;\n\n  switch (action.type) {\n    case 'RESET_SOCKET':\n      socket = action.payload || state.socket;\n      return { ...state, socket, api: null, apiState: null };\n\n    case 'CONNECT':\n      return { ...state, api: action.payload, apiState: 'CONNECTING' };\n\n    case 'CONNECT_SUCCESS':\n      return { ...state, apiState: 'READY' };\n\n    case 'CONNECT_ERROR':\n      return { ...state, apiState: 'ERROR' };\n\n    case 'SET_KEYRING':\n      return { ...state, keyring: action.payload, keyringState: 'READY' };\n\n    case 'KEYRING_ERROR':\n      return { ...state, keyring: null, keyringState: 'ERROR' };\n\n    default:\n      throw new Error(`Unknown type: ${action.type}`);\n  }\n};\n\nconst SubstrateContext = React.createContext();\n\nconst SubstrateContextProvider = (props) => {\n  // filtering props and merge with default param value\n  const initState = { ...INIT_STATE };\n  const neededPropNames = ['socket', 'types'];\n  neededPropNames.forEach(key => {\n    initState[key] = (typeof props[key] === 'undefined' ? initState[key] : props[key]);\n  });\n  const [state, dispatch] = useReducer(reducer, initState);\n\n  return (\n    <SubstrateContext.Provider value={[state, dispatch]}>\n      {props.children}\n    </SubstrateContext.Provider>\n  );\n};\n\n// prop typechecking\nSubstrateContextProvider.propTypes = {\n  socket: PropTypes.string,\n  types: PropTypes.object\n};\n\nexport { SubstrateContext, SubstrateContextProvider };\n","import { useContext, useEffect, useCallback } from 'react';\nimport { ApiPromise } from '@polkadot/api';\nimport { WsProvider } from '@polkadot/rpc-provider';\nimport { options } from '@encointer/node-api';\nimport * as eapi from '@encointer/node-api';\nimport encointerTypes from '@encointer/types';\n\nimport { SubstrateContext } from './SubstrateContext';\n\nconst useSubstrate = () => {\n  const [state, dispatch] = useContext(SubstrateContext);\n\n  // `useCallback` so that returning memoized function and not created\n  //   everytime, and thus re-render.\n  const { api, socket, types } = state;\n  const connect = useCallback(async () => {\n    if (api) return;\n\n    const provider = new WsProvider(socket);\n    // Connect to Encointer\n    const _api = await new ApiPromise({ ...options(\n      {\n        types: {\n          \"CurrencyIdentifier\": \"Hash\",\n          \"CurrencyCeremony\": \"(CurrencyIdentifier,CeremonyIndexType)\",\n          \"CurrencyPropertiesType\": {\n            \"name_utf8\": \"Vec<u8>\",\n            \"demurrage_per_block\": \"Demurrage\"\n          }\n        }\n      }\n    ), provider });\n\n    // We want to listen to event for disconnection and reconnection.\n    //  That's why we set for listeners.\n    _api.on('connected', () => {\n      dispatch({ type: 'CONNECT', payload: _api });\n      // `ready` event is not emitted upon reconnection. So we check explicitly here.\n      _api.isReady.then((_api) => dispatch({ type: 'CONNECT_SUCCESS' }));\n    });\n    _api.on('ready', () => dispatch({ type: 'CONNECT_SUCCESS' }));\n    _api.on('error', () => dispatch({ type: 'CONNECT_ERROR' }));\n  }, [api, socket, types, dispatch]);\n\n  useEffect(() => {\n    connect();\n  }, [connect]);\n\n  return { ...state, dispatch };\n};\n\nexport default useSubstrate;\n","import BigJS from 'big.js';\nimport toFormat from 'toformat';\n\nconst Big = toFormat(BigJS);\n\nconst utils = {\n  prettyBalance: function (amt, opts = {}) {\n    if (typeof amt !== 'number' && typeof amt !== 'string') {\n      throw new Error(`${amt} is not a number`);\n    }\n\n    // default option values\n    opts = { power: 8, decimal: 2, unit: 'Units', ...opts };\n\n    const bn = Big(amt);\n    const divisor = Big(10).pow(opts.power);\n    const displayed = bn.div(divisor).toFormat(opts.decimal);\n    return `${displayed.toString()} ${opts.unit}`;\n  }\n};\n\nexport default utils;\n","// This component will simply add utility functions to your developer console.\nimport { useSubstrate } from '../';\n\nexport default function DeveloperConsole (props) {\n  const { api } = useSubstrate();\n  window.api = api;\n  window.util = require('@polkadot/util');\n  window.util_crypto = require('@polkadot/util-crypto');\n  window.keyring = require('@polkadot/keyring');\n\n  return null;\n}\n","import React from 'react';\nimport { Sidebar, Menu, Icon } from 'semantic-ui-react';\n\nfunction MapMenuMain (props) {\n  return (\n    <Sidebar\n      as={Menu}\n      animation='overlay'\n      direction='left'\n      icon='labeled'\n      inverted\n      vertical\n      visible={props.visible}\n      width='thin'\n    >\n\n      <Menu.Item as='a' href='//encointer.org' target='_blank'>\n        <Icon name='book' />\n            Documentation\n      </Menu.Item>\n\n      <Menu.Item as='a' href='//encointer.org/testnet/' target='_blank' >\n        <Icon name='block layout' />\n            Testnet\n      </Menu.Item>\n\n      <Menu.Item as='a' href='//encointer.org/blog/' target='_blank'>\n        <Icon name='newspaper' />\n            Blog\n      </Menu.Item>\n\n      <Menu.Item as='a' href='//encointer.org/faq/' target='_blank'>\n        <Icon name='question circle' />\n            FAQ\n      </Menu.Item>\n\n      <Menu.Item as='a' href='//encointer.org/donate/' target='_blank'>\n        <Icon name='dollar' />\n           Donate\n      </Menu.Item>\n\n      <Menu.Item as='a' href='//encointer.org/about/' target='_blank'>\n        <Icon name='favorite' />\n           About\n      </Menu.Item>\n\n      <Menu.Item as='a' href='//github.com/encointer/encointer-node' target='_blank'>\n        <Icon name='github' />\n            Code\n      </Menu.Item>\n\n    </Sidebar>\n  );\n}\n\nexport default React.memo(MapMenuMain, (prev, cur) => prev.visible === cur.visible);\n","import React, { useEffect, useState } from 'react';\n\nconst phaseTimestampToTimer = (timestamp) => {\n  const timeSec = ((timestamp - Date.now()) / 1000) | 0;\n  if (timeSec >= 0) {\n    const seconds = timeSec % 60;\n    let minutes = (timeSec / 60) | 0;\n    let hours = minutes / 60 | 0;\n    const days = hours / 24 | 0;\n    if (hours > 0) {\n      minutes = minutes % 60;\n    }\n    if (days > 0) {\n      hours = hours % 24;\n    }\n    const daysStr = days ? days.toString().concat('d ') : '';\n    const hoursStr = hours.toString().padStart(2, '0');\n    const minutesStr = minutes.toString().padStart(2, '0');\n    const secondsStr = seconds.toString().padStart(2, '0');\n    return `${daysStr}${hoursStr}:${minutesStr}:${secondsStr}`;\n  } else {\n    return 'finished';\n  }\n};\n\nexport function CeremonyPhaseTimer (props) {\n  const { nextPhaseTimestamp } = props;\n  const [timer, setTimer] = useState('');\n\n  useEffect(() => {\n    setTimer(phaseTimestampToTimer(nextPhaseTimestamp));\n    const id = setInterval(() => {\n      setTimer(phaseTimestampToTimer(nextPhaseTimestamp));\n    }, 1000);\n    return () => clearInterval(id);\n  }, [nextPhaseTimestamp]);\n\n  return <React.Fragment>{timer}</React.Fragment>;\n}\n","import React from 'react';\nimport { Step, Label } from 'semantic-ui-react';\nimport { CeremonyPhaseTimer } from './CeremonyPhaseTimer';\n\nconst ceremonyPhases = [\n  'REGISTERING',\n  'ASSIGNING',\n  'ATTESTING'\n];\n\nconst formatDate = (timestamp) => (new Date(timestamp)).toLocaleString();\n\nconst formatStartingAt = (timestamp) => (<div><div>starting at:</div> {formatDate(timestamp)}</div>);\n\nexport default React.memo(function MapCeremonyPhases (props) {\n  const {\n    small,\n    participantCount,\n    meetupCount,\n    attestationCount,\n    currentPhase: {\n      phase: currentPhase,\n      timestamp\n    }\n  } = props;\n\n  const counter = [participantCount, meetupCount, attestationCount];\n\n  const phasesSteps = phase => {\n    const phasesProps = (currentPhase === -1 ? [] : ceremonyPhases)\n      .map((phase, idx) => ({\n        key: ceremonyPhases[idx],\n        counter: counter[idx],\n        active: (idx === currentPhase),\n        className: 'step-'.concat(ceremonyPhases[idx]).toLowerCase()\n      })).filter((prop, idx) =>\n        !small || prop.active || idx === currentPhase + 1 || (idx === 0 && currentPhase === 2)\n      );\n    return (small && currentPhase === 2) ? phasesProps.reverse() : phasesProps;\n  };\n\n  return (<div className='encointer-map-ceremony-phase'>\n    <Step.Group\n      ordered\n      unstackable\n      className={[\n        ceremonyPhases[currentPhase],\n        small ? 'small-screen' : ''\n      ].join(' ')}\n      size='mini'>{\n        phasesSteps(currentPhase)\n          .map((props, idx) => (\n            <Step {...props}>\n              <Step.Content>\n                <Step.Title>\n                  {props.key} {\n                    (idx <= currentPhase && props.counter) ? <Label circular color={props.active ? 'green' : 'grey'}>{props.counter}</Label> : null\n                  }</Step.Title>\n                <Step.Description>{\n                  (props.active)\n                    ? <div><div>time left: </div><CeremonyPhaseTimer nextPhaseTimestamp={timestamp} /></div>\n                    : (small\n                      ? formatStartingAt(timestamp)\n                      : ((idx === (currentPhase + 1) ||\n                          (idx === 0 && currentPhase === 2))\n                        ? formatStartingAt(timestamp)\n                        : null))\n                }</Step.Description>\n              </Step.Content>\n            </Step>\n          ))\n      }</Step.Group>\n  </div>);\n}, (newProp, oldProp) => {\n  return (oldProp.small === newProp.small &&\n          oldProp.participantCount === newProp.participantCount &&\n          oldProp.meetupCount === newProp.meetupCount &&\n          oldProp.attestationCount === newProp.attestationCount &&\n          oldProp.currentPhase.phase === newProp.currentPhase.phase &&\n          oldProp.currentPhase.timestamp === newProp.currentPhase.timestamp);\n});\n","import React, { useEffect, useState } from 'react';\nimport { Card, Loader, Icon } from 'semantic-ui-react';\n\nconst Blocks = React.memo(props => {\n  const { api } = props;\n  const [blockNumber, setBlockNumber] = useState(0);\n  const bestNumber = api && api.derive && api.derive.chain && (props.finalized\n    ? api.derive.chain.bestNumberFinalized\n    : api.derive.chain.bestNumber);\n  useEffect(() => {\n    let unsubscribeAll;\n    bestNumber && bestNumber(blockNumber => {\n      setBlockNumber(blockNumber.toNumber());\n    }).then(unsub => {\n      unsubscribeAll = unsub;\n    })\n      .catch(console.error);\n    return () => unsubscribeAll && unsubscribeAll();\n  }, [bestNumber]);\n  return <React.Fragment>{blockNumber}</React.Fragment>;\n}, _ => true);\n\nconst CeremonyIndex = React.memo(props => {\n  const {\n    api: {\n      query: {\n        encointerScheduler: {\n          currentCeremonyIndex: getCurrentCeremonyIndex\n        }\n      }\n    }\n  } = props;\n  const [currentCeremonyIndex, setCurrentCeremonyIndex] = useState(0);\n  useEffect(() => {\n    let unsubscribeAll;\n    getCurrentCeremonyIndex(newCeremonyIndex => {\n      setCurrentCeremonyIndex(newCeremonyIndex.toNumber());\n    }).then(unsub => {\n      unsubscribeAll = unsub;\n    })\n      .catch(console.error);\n    return () => unsubscribeAll && unsubscribeAll();\n  }, [getCurrentCeremonyIndex]);\n  return (currentCeremonyIndex\n    ? <React.Fragment>\n      <span>ceremony</span> <strong> #{currentCeremonyIndex}</strong>\n    </React.Fragment>\n    : null);\n}, _ => true);\n\nfunction MapNodeInfoMain (props) {\n  const { apiState, api, onClickNode } = props;\n  const [nodeInfo, setNodeInfo] = useState({});\n  const system = api && api.rpc && api.rpc.system;\n  const getCurrentCeremonyIndex = api && api.query && api.query.encointerScheduler &&\n        api.query.encointerScheduler.currentCeremonyIndex;\n\n  useEffect(() => {\n    if (system) {\n      const getInfo = async () => {\n        try {\n          const [chain, nodeName, nodeVersion] = await Promise.all([\n            system.chain(),\n            system.name(),\n            system.version()\n          ]);\n          setNodeInfo({ chain, nodeName, nodeVersion });\n        } catch (e) {\n          console.error(e);\n        }\n      };\n      getInfo();\n    }\n  }, [system]);\n\n  return (\n    <Card className='encointer-map-node-info' style={props.style || {}}>{\n      apiState === 'READY'\n        ? <React.Fragment>\n          <Card.Content className='info' onClick={onClickNode}>\n            <Card.Header>{nodeInfo.nodeName} <Icon name='chevron down' /></Card.Header>\n            <Card.Meta>{`${nodeInfo.chain || ''} v${nodeInfo.nodeVersion}`}</Card.Meta>\n          </Card.Content>\n          <Card.Content className='blocks'>\n            {\n              getCurrentCeremonyIndex\n                ? <React.Fragment>\n                  <Card.Meta></Card.Meta>\n                  <div className='block-current'>current block #<Blocks api={api} /></div>\n                  <div className='finalized-current'>finalized block #<Blocks finalized api={api} /></div>\n                  <div className='ceremony'><CeremonyIndex api={api} /></div>\n                </React.Fragment>\n                : <React.Fragment>\n                  <div className='loading'>\n                    <Loader active size='medium' inline='centered' />\n                  </div>\n                </React.Fragment>\n            }\n          </Card.Content>\n        </React.Fragment>\n        : <Card.Content className='loading'>\n          {\n            apiState !== 'ERROR'\n              ? <Card.Meta><Loader active size='small' inline /> Connecting to the blockchain</Card.Meta>\n              : <Card.Meta className='error'>Error connecting to the blockchain</Card.Meta>\n          }\n        </Card.Content>\n    }</Card>\n  );\n}\n\nexport default function MapNodeInfo (props) {\n  return <MapNodeInfoMain {...props} />;\n}\n","import React from 'react';\nimport { Button, Menu } from 'semantic-ui-react';\n\nfunction MapControl (props) {\n  const { loading, onZoomIn, onZoomOut, onClick } = props;\n  return (\n    <Menu className='encointer-map-floating-widgets' stackable size='mini' vertical>\n      <Menu.Item >\n        <Button onClick={onClick} loading={loading} disabled={loading} icon='sidebar' className='encoiner-menu-button' />\n      </Menu.Item>\n      <Menu.Item >\n        <Button.Group vertical compact size='small'>\n          <Button icon='plus' onClick={onZoomIn}/>\n          <Button icon='minus' onClick={onZoomOut}/>\n        </Button.Group>\n      </Menu.Item>\n    </Menu>\n  );\n}\n\nexport default React.memo(MapControl, (prev, cur) => prev.loading === cur.loading);\n","import assert from 'assert';\n\n/// Function to produce function to convert fixed-point to Number\n///\n/// Fixed interpretation of u<N> place values\n/// ... ___ ___ ___ ___ . ___ ___ ___ ___ ...\n/// ...  8   4   2   1    1/2 1/4 1/8 1/16...\n///\n/// Parameters:\n/// upper: 0..128 - number of bits in decimal part\n/// lower: 0..128 - number of bits in fractional part\n///\n/// Produced function parameters:\n/// raw: substrate_fixed::types::I<upper>F<lower> as I<upper+lower>\n/// precision: 0..lower number bits in fractional part to process\nexport function parserFixPoint (upper, lower) {\n  const len = upper + lower;\n  assert(len >= 8, `Bit length can't be less than 8, provided ${len}`);\n  assert(len <= 128, `Bit length can't be bigger than 128, provided ${len}`);\n  assert(!(len & (len - 1)), `Bit length should be power of 2, provided ${len}`);\n\n  return (raw, precision = lower) => {\n    assert(raw.bitLength() === len, 'Bit length is not equal to ' + len);\n    const bits = raw.toString(2, len);\n    const lowerBits = (lower > bits.length\n      ? bits.padStart(lower, '0')\n      : bits).slice(-lower, -1 * (lower - precision) || undefined);\n    const floatPart = lowerBits\n      .split('')\n      .reduce((acc, bit, idx) => {\n        acc = acc + (bit === '1' ? 1 / 2 ** (idx + 1) : 0);\n        return acc;\n      }, 0);\n    const upperBits = bits.slice(0, -lower);\n    const decimalPart = upperBits ? parseInt(upperBits, 2) : 0;\n    return decimalPart + (raw.negative ? -floatPart : floatPart);\n  };\n}\n\nexport const parseI4F4 = parserFixPoint(4, 4);\n\nexport const parseI8F8 = parserFixPoint(8, 8);\n\nexport const parseI16F16 = parserFixPoint(16, 16);\n\nexport const parseI32F32 = parserFixPoint(32, 32);\n\nexport const parseI64F64 = parserFixPoint(64, 64);\n\n/// map and reduce helper\nfunction mapReduce (arr, mapperFn, reducerFn) {\n  let result = arr;\n  if (mapperFn) {\n    result = result.map(mapperFn);\n  }\n  if (reducerFn) {\n    result = result.reduce(reducerFn, {});\n  }\n  return result;\n}\n\n/// Function that calls provided api method parameters provided in ids array\n/// Will return value when all promises finishes optionally converted with mapperFn\nexport async function batchFetch (apiMethod, ids, mapperFn, reducerFn) {\n  const responses = await Promise.all(ids.map(it => apiMethod(it))); // array of fetching promises\n  return mapReduce(responses, mapperFn, reducerFn); // Called when all promises fullfils\n}\n","import React, { useEffect, useCallback, useState, useRef } from 'react';\nimport { Button, Segment, Header, Icon, List, Message, Sidebar } from 'semantic-ui-react';\nimport Big from 'big.js';\nimport toFormat from 'toformat';\n\nimport { parseI64F64 } from '../utils';\n\nconst BigFormat = toFormat(Big);\n\nfunction MapSidebarMain (props) {\n  const {\n    api,\n    debug,\n    onClose,\n    onShow,\n    hash,\n    direction,\n    width,\n    participantCount,\n    lastParticipantCount,\n    lastMeetupCount,\n    meetupCount,\n    data: {\n      name, cid, demurrage, demurragePerBlock\n    }\n  } = props;\n  const visible = !!hash.length;\n  const ref = useRef();\n  const isVertical = direction === 'top' || direction === 'bottom';\n\n  const [bootstrappers, setBootstrappers] = useState([]);\n  const [entry, setEntry] = useState(null);\n  const [currentBlock, setCurrentBlock] = useState(1);\n  const [moneySupply, setMoneySupply] = useState(0);\n\n  useEffect(() => {\n    let unsubscribeAll;\n    const bestNumber = api.derive.chain.bestNumber;\n    bestNumber(blockNumber => {\n      setCurrentBlock(blockNumber.toNumber());\n    }).then(unsub => {\n      console.log('U', unsub);\n      unsubscribeAll = unsub;\n    });\n    return () => unsubscribeAll && unsubscribeAll();\n  }, [api.derive.chain.bestNumber]);\n\n  /// Fetch bootstrappers\n  useEffect(() => {\n    let unsubscribeAll;\n    if (cid && api.query.encointerCommunities) {\n      debug && console.log('GETTING BOOTSTRAPPERS', cid);\n      api.query.encointerCommunities\n        .bootstrappers(cid, _ => {\n          debug && console.log('BOOTSTRAPPERS RECEIVED', _);\n          setBootstrappers(_.toJSON());\n        }).then(unsub => {\n          unsubscribeAll = unsub;\n        })\n        .catch(console.error);\n      return () => unsubscribeAll && unsubscribeAll();\n    }\n  }, [api.query.encointerCommunities, cid, debug]);\n\n  /// Fetch money supply\n  useEffect(() => {\n    let unsubscribeAll;\n    if (cid && api.query.encointerBalances) {\n      debug && console.log('GETTING MONEYSUPPLY', cid);\n      api.query.encointerBalances\n        .totalIssuance(cid, _ => {\n          debug && console.log('MONEYSUPPLY RECEIVED', _);\n          setEntry({\n            principal: parseI64F64(_.get('principal')),\n            lastUpdate: _.get('last_update').toNumber()\n          });\n        }).then(unsub => {\n          unsubscribeAll = unsub;\n        })\n        .catch(console.error);\n      return () => unsubscribeAll && unsubscribeAll();\n    }\n  }, [api.query.encointerBalances, cid, debug]);\n\n  /// Apply demurrage\n  const applyDemurrage = useCallback(() => {\n    const moneySupply = (entry && entry.principal > 0) ? entry.principal * Math.exp(-demurragePerBlock * (currentBlock - entry.lastUpdate)) : 0;\n    setMoneySupply(moneySupply);\n  }, [demurragePerBlock, currentBlock, entry]\n  );\n\n  useEffect(() => {\n    applyDemurrage();\n  }, [applyDemurrage]);\n\n  /// Handler when sidebar completely shows (animation stops)\n  const handleShow = () => ref.current && onShow(ref.current.ref.current[\n    `offset${isVertical ? 'Height' : 'Width'}`\n  ]);\n\n  return (\n    <Sidebar\n      className='details-sidebar'\n      ref={ref}\n      as={Segment.Group}\n      animation='overlay'\n      icon='labeled'\n\n      direction={direction}\n      visible={visible}\n      width={width}\n      onShow={handleShow}\n    >\n      <Segment padded>\n        <Header>\n          <Icon name='money bill alternate' />\n          <Header.Content>Currency info</Header.Content>\n        </Header>\n      </Segment>\n\n      <Segment textAlign='center'>\n        <Header sub textAlign='left'>Currency ID:</Header>\n        <Message size='small' color='blue'>{hash}</Message>\n        <p>{name}</p>\n      </Segment>\n\n      <Segment.Group>\n\n        <Segment.Group horizontal>\n          <Segment>\n            <Header sub>Demurrage rate (per month):</Header>\n            {demurrage && demurrage.toFixed(2)}%\n            <Header sub>participants registered:</Header>\n            {participantCount}\n            <Header sub>participants registered in last ceremony:</Header>\n            {lastParticipantCount}\n          </Segment>\n          <Segment>\n            <Header sub>Money supply:</Header>\n            <p>{ !isNaN(moneySupply) && (new BigFormat(moneySupply)).toFormat(2) }</p>\n            <Header sub>meetups assigned:</Header>\n            {meetupCount}\n            <Header sub>meetups assigned in last ceremony:</Header>\n            {lastMeetupCount}\n          </Segment>\n        </Segment.Group>\n\n        <Segment loading={!bootstrappers.length} stacked>\n          <Header sub>List of bootstrappers:</Header>\n          <List>{\n            bootstrappers.map(\n              _ => <List.Item key={_}>{_}</List.Item>\n            )\n          }</List>\n        </Segment>\n\n      </Segment.Group>\n\n      <Segment textAlign='right' className='map-sidebar-close'>\n        <Button\n          content='Close'\n          icon={'angle ' + (isVertical ? 'down' : 'right')}\n          labelPosition='right'\n          onClick={onClose}/>\n      </Segment>\n\n    </Sidebar>\n  );\n}\n\nexport default React.memo(function MapSidebar (props) {\n  const { api } = props;\n  return api && api.query ? (\n    <MapSidebarMain {...props} />\n  ) : null;\n}, (prev, cur) => (\n  prev.hash === cur.hash && (\n    cur.hash\n      ? prev.participantCount === cur.participantCount &&\n      prev.lastParticipantCount === cur.lastParticipantCount &&\n      prev.meetupCount === cur.meetupCount &&\n      prev.lastMeetupCount === cur.lastMeetupCount\n      : true)\n));\n","import React, { useCallback, useMemo, useState } from 'react';\nimport { Button, Icon, Input, Sidebar, Radio, Segment } from 'semantic-ui-react';\n\nexport const CUSTOM_ENDPOINT_KEY = 'encointer-explorer-custom-endpoints';\n\nfunction getCustomEndpoints () {\n  try {\n    const storedAsset = localStorage.getItem(CUSTOM_ENDPOINT_KEY);\n\n    if (storedAsset) {\n      return JSON.parse(storedAsset);\n    }\n  } catch (e) {\n    console.error(e);\n    // ignore error\n  }\n\n  return [];\n}\n\nfunction createOwn () {\n  const items = getCustomEndpoints();\n  return items.map((item) => ({\n    info: 'local',\n    text: 'Custom: '.concat(item),\n    value: item\n  }));\n}\n\nfunction createEndpoints () {\n  return [\n    {\n      isHeader: true,\n      text: 'Test networks',\n      value: ''\n    },\n    // Hardcode default nodes for now\n    {\n      info: 'encointer',\n      text: 'Gesell',\n      icon: 'encointer-notee.svg',\n      provider: 'Encointer Association',\n      value: 'wss://gesell.encointer.org'\n    },\n    {\n      info: 'encointer',\n      text: 'Cantillon',\n      icon: 'encointer-teeproxy.svg',\n      provider: 'Encointer Association',\n      value: 'wss://cantillon.encointer.org'\n    },\n    {\n      isDevelopment: true,\n      isHeader: true,\n      text: 'Development',\n      value: ''\n    },\n    {\n      info: 'local',\n      text: 'Local Node (Own, 127.0.0.1:9944)',\n      value: 'ws://127.0.0.1:9944'\n    },\n    ...createOwn()\n  ].filter(({ isDisabled }) => !isDisabled);\n}\n\nfunction combineEndpoints (endpoints) {\n  return endpoints.reduce((result, e) => {\n    if (e.isHeader) {\n      result.push({ header: e.text, isDevelopment: e.isDevelopment, networks: [] });\n    } else {\n      const name = e.text;\n      const prev = result[result.length - 1];\n      const prov = { name: e.provider ? 'hosted by ' + e.provider : e.value, url: e.value };\n\n      if (prev.networks[prev.networks.length - 1] && name === prev.networks[prev.networks.length - 1].name) {\n        prev.networks[prev.networks.length - 1].providers.push(prov);\n      } else {\n        prev.networks.push({\n          icon: e.icon,\n          isChild: e.isChild,\n          name,\n          providers: [prov]\n        });\n      }\n    }\n\n    return result;\n  }, []);\n}\n\nfunction Url ({ apiUrl, className, label, setApiUrl, url }) {\n  const _setApiUrl = useCallback(\n    () => setApiUrl(url),\n    [setApiUrl, url]\n  );\n\n  return (\n    <Radio\n      className={className}\n      label={label}\n      onChange={_setApiUrl}\n      checked={apiUrl === url}\n    />\n  );\n}\n\nfunction Network ({ apiUrl, className = '', setApiUrl, value: { icon, isChild, name, providers } }) {\n  const isSelected = useMemo(\n    () => providers.some(({ url }) => url === apiUrl),\n    [apiUrl, providers]\n  );\n\n  const _selectFirst = useCallback(\n    () => setApiUrl(providers[0].url),\n    [providers, setApiUrl]\n  );\n\n  return (\n    <div className={`endpoint-network ${className}${isSelected ? ' isSelected highlight--border' : ''}`}>\n      <div\n        className={`endpoint-section${isChild ? ' isChild' : ''}`}\n        onClick={_selectFirst}\n      >\n        {icon ? <img className='endpoint-icon' alt='chain logo' src={'/'.concat(icon)} /> : null}\n        <div className='endpoint-value'>{name}</div>\n      </div>\n      {isSelected && providers.map(({ name, url }): React.ReactNode => (\n        <Url\n          apiUrl={apiUrl}\n          key={url}\n          label={name}\n          setApiUrl={setApiUrl}\n          url={url}\n          className='endpoint-address'\n        />\n      ))}\n    </div>\n  );\n}\n\nfunction GroupDisplay ({ apiUrl, children, className = '', index, isSelected, setApiUrl, setGroup, value: { header, networks } }) {\n  const _setGroup = useCallback(\n    () => setGroup(isSelected ? -1 : index),\n    [index, isSelected, setGroup]\n  );\n\n  return (\n    <Segment\n      padded\n      className={`${className}${isSelected ? ' isSelected' : ''}`}>\n      <div\n        className='groupHeader'\n        onClick={_setGroup}\n      >\n        <Icon name={isSelected ? 'chevron up' : 'chevron down'} />\n        {header}\n      </div>\n      {isSelected && (\n        <>\n          <div className='group-networks'>\n            {networks.map((network, index): React.ReactNode => (\n              <Network\n                apiUrl={apiUrl}\n                key={index}\n                setApiUrl={setApiUrl}\n                value={network}\n              />\n            ))}\n          </div>\n          {children}\n        </>\n      )}\n    </Segment>\n  );\n}\n\nfunction isValidUrl (url) {\n  return (\n    // some random length... we probably want to parse via some lib\n    (url.length >= 7) &&\n    // check that it starts with a valid ws identifier\n    (url.startsWith('ws://') || url.startsWith('wss://'))\n  );\n}\n\nexport default function Endpoints (props) {\n  const { socket, onClose, visible } = props;\n  const linkOptions = createEndpoints();\n  const [groups, setGroups] = useState(combineEndpoints(linkOptions));\n  const extractUrlState = useCallback((apiUrl, groups) => {\n    let groupIndex = groups.findIndex(({ networks }) =>\n      networks.some(({ providers }) =>\n        providers.some(({ url }) => url === apiUrl)\n      )\n    );\n\n    if (groupIndex === -1) {\n      groupIndex = groups.findIndex(({ isDevelopment }) => isDevelopment);\n    }\n\n    return {\n      apiUrl,\n      groupIndex,\n      hasUrlChanged: socket !== apiUrl,\n      isUrlValid: isValidUrl(apiUrl)\n    };\n  }, [socket]);\n  const [{ apiUrl, groupIndex, hasUrlChanged, isUrlValid }, setApiUrl] = useState(extractUrlState(socket, groups));\n  const [storedCustomEndpoints, setStoredCustomEndpoints] = useState(getCustomEndpoints());\n\n  const isKnownUrl = useMemo(() => {\n    let result = false;\n\n    linkOptions.some((endpoint) => {\n      if (endpoint.value === apiUrl) {\n        result = true;\n\n        return true;\n      }\n\n      return false;\n    });\n\n    return result;\n  }, [apiUrl, linkOptions]);\n\n  const isSavedCustomEndpoint = useMemo(() => {\n    let result = false;\n\n    storedCustomEndpoints.some((endpoint) => {\n      if (endpoint === apiUrl) {\n        result = true;\n\n        return true;\n      }\n\n      return false;\n    });\n\n    return result;\n  }, [apiUrl, storedCustomEndpoints]);\n\n  const _changeGroup = useCallback(\n    (groupIndex) => setApiUrl((state) => ({ ...state, groupIndex })),\n    []\n  );\n\n  const _removeApiEndpoint = () => {\n    if (!isSavedCustomEndpoint) return;\n\n    const newStoredCurstomEndpoints = storedCustomEndpoints.filter((url) => url !== apiUrl);\n\n    try {\n      localStorage.setItem(CUSTOM_ENDPOINT_KEY, JSON.stringify(newStoredCurstomEndpoints));\n      setGroups(combineEndpoints(createEndpoints()));\n      setStoredCustomEndpoints(getCustomEndpoints());\n    } catch (e) {\n      console.error(e);\n      // ignore error\n    }\n  };\n\n  const _setApiUrl = useCallback(\n    (apiUrl) => setApiUrl(extractUrlState(apiUrl, groups)),\n    [extractUrlState, groups]\n  );\n\n  const _onChangeCustom = useCallback(\n    e => {\n      const apiUrl = e.target.value;\n      setApiUrl(extractUrlState(apiUrl, groups));\n    },\n    [extractUrlState, groups]\n  );\n\n  const _onApply = useCallback(\n    () => {\n      window.location.assign(`${window.location.origin}${window.location.pathname}?rpc=${encodeURIComponent(apiUrl)}${window.location.hash}`);\n      onClose();\n    },\n    [apiUrl, onClose]\n  );\n\n  const _saveApiEndpoint = () => {\n    try {\n      localStorage.setItem(CUSTOM_ENDPOINT_KEY, JSON.stringify([...storedCustomEndpoints, apiUrl]));\n      _onApply();\n    } catch (e) {\n      console.error(e);\n      // ignore error\n    }\n  };\n\n  return (\n    <Sidebar\n      visible={visible}\n      as={Segment.Group}\n      className='node-switch-widget'\n      onClose={onClose}\n      position='left'\n      vertical='true'\n      width='wide'\n      animation='overlay'\n    >\n      {groups.map((group, index) => (\n        <GroupDisplay\n          apiUrl={apiUrl}\n          index={index}\n          isSelected={groupIndex === index}\n          key={index}\n          setApiUrl={_setApiUrl}\n          setGroup={_changeGroup}\n          value={group}\n        >\n          {group.isDevelopment && (\n            <div className='endpointCustomWrapper'>\n              <div>Custom endpoint</div>\n\n              <Input\n                className='endpointCustom'\n                error={!isUrlValid}\n                onChange={_onChangeCustom}\n                value={apiUrl}\n                action={\n                  isSavedCustomEndpoint\n                    ? <Button onClick={_removeApiEndpoint}> <Icon name='trash alternate' /></Button>\n                    : <Button onClick={_saveApiEndpoint} > <Icon name='save' /></Button>\n                } />\n            </div>\n          )}\n        </GroupDisplay>\n      ))}\n\n      <Segment className='node-switch-confirm'>\n        <Button\n          icon='sync'\n          disabled={!(hasUrlChanged && isUrlValid)}\n          positive={true}\n          content=\"Switch\"\n          onClick={_onApply}\n          fluid\n        />\n      </Segment>\n\n      <Segment textAlign='left' className='node-switch-close'>\n        <Button\n          content='Close'\n          labelPosition='left'\n          icon='angle left'\n          onClick={onClose}/>\n\n      </Segment>\n    </Sidebar>\n  );\n}\n","import * as L from 'leaflet';\n\nconst DivIcon = L.divIcon;\n\nconst commonClassName = 'marker-cluster marker-cluster-small ';\nconst markerClassName = commonClassName.concat('encoiner-community-icon');\nconst clusterClassName = commonClassName.concat('encoiner-cluster-custom');\n\nconst iconSize = [40, 40];\n\nexport const icon = (className, count) => new DivIcon({\n  iconSize,\n  className: ''.concat(className),\n  html: '<div><span>'.concat(count, '</span></div>')\n});\n\nexport const communityIcon = (className) => icon(markerClassName.concat(' ', className), '$');\n\nexport const clusterIcon = (className, count) => icon(clusterClassName.concat(' ', className), count);\n\nexport const iconActive = communityIcon('');\n\nexport const iconActivePulse = communityIcon('pulse');\n\nexport const iconSemiactivePulse = communityIcon('yellow pulse');\n\nexport const iconSemiactive = communityIcon('yellow');\n\nexport const iconInactive = communityIcon('red');\n\nexport const locationMarker = new L.Icon({\n  iconUrl: 'https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png',\n  shadowUrl: 'https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png',\n  iconSize: [25, 41],\n  iconAnchor: [12, 41],\n  popupAnchor: [1, -34],\n  shadowSize: [41, 41]\n});\n\nexport const getClusterIcon = (phase, count, active) => {\n  let className;\n  if (phase === 0) { // in REGISTERING phase\n    className = count ? 'green' : 'yellow'; // green if >0 registered\n  } else if (count !== 0) {\n    className = count > 1 ? 'green' : 'yellow'; // if 1 meetup then yellow, if >1 green\n  } else {\n    className = 'red'; // in ASSIGNING and ATTESTING if 0 meetups\n  }\n  if (active) { // animated icon\n    return className.concat(' pulse');\n  } else {\n    return className;\n  }\n};\n","import React, { useEffect, useRef, useReducer } from 'react';\nimport { Marker, Tooltip } from 'react-leaflet';\nimport MarkerClusterGroup from 'react-leaflet-markercluster';\nimport { iconActive, iconActivePulse, iconSemiactive, iconSemiactivePulse, iconInactive, clusterIcon, getClusterIcon } from './MarkerIcon';\n\nconst pulseTimer = 3000;\nconst iconSize = [40, 40];\n\nconst iconSet = {\n  'green pulse': iconActivePulse,\n  'yellow pulse': iconSemiactivePulse,\n  'red pulse': iconSemiactivePulse,\n  green: iconActive,\n  yellow: iconSemiactive,\n  red: iconInactive\n};\n\nconst getIcon = (phase, count, active) => {\n  const iconClass = getClusterIcon(phase, count, active);\n  return iconSet[iconClass];\n};\n\nconst createClusterCustomIcon = function (cluster) {\n  const markers = cluster.getAllChildMarkers();\n  const phase = markers[0].options.phase;\n  const count = markers\n    .map(it => it.options.count)\n    .reduce((acc, it) => it > acc ? it : acc, 0);\n  const active = markers\n    .map(it => it.options.active)\n    .reduce((acc, it) => it || acc, false);\n\n  const iconClass = getClusterIcon(phase, count, active);\n  const markerCount = cluster.getChildCount();\n  return clusterIcon(iconClass, markerCount);\n};\n\nconst initialState = {\n  timers: {},\n  byCID: {},\n  phase: -1\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'initialize':\n      return ((state, action) => {\n        const { phase, byCID } = action.payload;\n        return { ...state, byCID, phase };\n      })(state, action);\n\n    case 'phase':\n      return { ...state, phase: action.payload };\n\n    case 'reset':\n      return ((state, action) => {\n        const { phase, byCID } = action.payload;\n        const markers = { ...state.byCID };\n        for (const cid in markers) {\n          markers[cid].count = byCID[cid] || 0;\n        }\n        return { ...state, byCID: markers, phase };\n      })(state, action);\n\n    case 'activate':\n      return ((state, action) => {\n        const { payload } = action;\n        const { timers } = payload;\n        const byCID = { ...state.byCID, ...payload.byCID };\n        for (const tid in timers) {\n          state.timers[tid] && clearTimeout(state.timers[tid]);\n        }\n        return { ...state, byCID, timers: { ...state.timers, ...timers } };\n      })(state, action);\n\n    case 'deactivate':\n      return ((state, action) => {\n        const cid = action.payload;\n        const byCID = { ...state.byCID };\n        const timers = { ...state.timers };\n        byCID[cid] = { ...byCID[cid], active: false };\n        clearTimeout(timers[cid]);\n        timers[cid] = 0;\n        return { ...state, byCID, timers };\n      })(state, action);\n    default:\n      return state;\n  }\n};\n\n/// communities markers layer with clusterization\nexport function CommunitiesClusters (props) {\n  const { cids, data, selected, state } = props;\n  const [markers, dispatch] = useReducer(reducer, initialState);\n  const ref = useRef(null);\n  const handleMarkerClick = _ => _.sourceTarget.options.alt && props.onClick(_.sourceTarget.options.alt);\n  const phase = state.subscribtionPhase;\n  const counters = state[['participants', 'meetups', 'meetups'][phase]]; // counter for each phase is meetups\n  const attestations = state.attestations; // counter for ATTESTING phase is meetups\n  const byCID = markers.byCID;\n\n  /// Init markers\n  if (markers.phase === -1 && phase !== -1) {\n    const byCID = cids.map(cid => {\n      const { position, name } = data[cid];\n      const meetups = state.meetups[cid] || 0;\n      const count = phase ? meetups : (counters[cid] || 0);\n      const attests = phase === 2 ? (attestations[cid] || 0) : 0;\n      return {\n        name,\n        key: cid,\n        position,\n        active: false,\n        count,\n        attests\n      };\n    }).reduce((acc, marker) => {\n      acc[marker.key] = marker;\n      return acc;\n    }, {});\n    dispatch({ type: 'initialize', payload: { byCID, phase } });\n  } else if (phase > markers.phase || (phase === 0 && markers.phase === 2)) {\n    /// Reset counters\n    dispatch({ type: 'reset', payload: { byCID: counters, phase } });\n  }\n\n  /// Update counters\n  useEffect(() => { /* eslint-disable react-hooks/exhaustive-deps */\n    const newMarkers = {};\n    const timers = {};\n    cids.forEach((cid) => {\n      const counter = counters ? (counters[cid] || 0) : 0;\n      const attests = attestations ? attestations[cid] : 0;\n      if (markers.byCID[cid] && (markers.byCID[cid].count < counter ||\n          markers.byCID[cid].attests < attests)) {\n        newMarkers[cid] = markers.byCID[cid];\n        newMarkers[cid].count = counter;\n        newMarkers[cid].attests = attestations[cid] || 0;\n        newMarkers[cid].active = true;\n        timers[cid] = setTimeout(() => {\n          dispatch({ type: 'deactivate', payload: cid });\n        }, pulseTimer);\n      }\n    });\n    dispatch({ type: 'activate', payload: { byCID: newMarkers, timers } });\n  }, [counters, attestations, cids]);\n\n  // Update clusters\n  useEffect(() => {\n    let tid;\n    const active = [];\n    for (const cid in markers.byCID) {\n      if (markers.byCID[cid].active) {\n        active.push(cid);\n      }\n    }\n    if (active.length) {\n      tid = setTimeout(() => { // redraw clusters\n        if (ref.current !== null && ref.current.leafletElement) {\n          ref.current.leafletElement.refreshClusters();\n        }\n      }, 10);\n    }\n\n    return () => {\n      tid && clearTimeout(tid);\n    };\n  }, [byCID]);\n\n  return (\n    <MarkerClusterGroup ref={ref} onClick={handleMarkerClick}\n      iconCreateFunction={createClusterCustomIcon}\n      chunkedLoading={true}\n    >{\n        cids.map(cid => {\n          const { position, name } = data[cid];\n          const { active, count, attests } = byCID[cid] || {};\n          const isSelected = selected === cid;\n          return (isSelected ? null : <Marker\n            key={cid.concat(phase, attests, count, active ? 'force-redraw' : '')}\n            position={position}\n            alt={cid}\n            count={count}\n            active={active}\n            phase={phase}\n            attests={attests}\n            icon={ getIcon(markers.phase, count, active) }>\n            <Tooltip direction='top' offset={[0, iconSize[1] / -2]}>{name}</Tooltip>\n          </Marker>);\n        })\n      }</MarkerClusterGroup>);\n}\n","import React, { useReducer, useEffect, useRef } from 'react';\nimport { Marker } from 'react-leaflet';\nimport MarkerClusterGroup from 'react-leaflet-markercluster';\n\nimport { locationMarker, clusterIcon, getClusterIcon } from './MarkerIcon';\n\nconst pulseTimer = 3000;\n\nconst createClusterCustomIcon = function (cluster) {\n  const markers = cluster.getAllChildMarkers();\n  const phase = markers[0].options.phase;\n  const count = markers[0].options.count;\n  const active = markers[0].options.active;\n  const markerCount = markers.length;\n  return clusterIcon(getClusterIcon(phase, count, active), markerCount);\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'reset':\n      return { active: false, count: 0, attest: 0, timeout: state.timeout };\n    case 'activate':\n      return ((state, action) => {\n        const { count, timeout, attest } = action.payload;\n        return { ...state, active: true, count, attest, timeout };\n      })(state, action);\n    case 'deactivate':\n      return ((state, action) => {\n        clearTimeout(state.timeout);\n        return { ...state, active: false };\n      })(state, action);\n    default:\n      return state;\n  }\n};\n\n/// Markers layer\nexport function LocationsLayer (props) {\n  const { phase, meetupCount, participantCount, attestationCount: attest } = props;\n  const { coords } = props.data;\n  const ref = useRef(null);\n  const count = phase === 0 ? participantCount : meetupCount;\n  const [state, dispatch] = useReducer(reducer, { active: false, count, attest });\n\n  const active = state.active;\n\n  /// Trigger active\n  useEffect(() => {\n    if (count === 0 && phase === 0 && (state.attest > 0 || state.count > 0)) {\n      dispatch({ type: 'reset' });\n      return;\n    }\n    if (state.count < count || state.attest < attest) {\n      const timeout = setTimeout(() => {\n        dispatch({ type: 'deactivate' });\n      }, pulseTimer);\n      dispatch({ type: 'activate', payload: { count, timeout, attest } });\n    }\n  }, [state, count, attest, phase]);\n\n  // Update clusters\n  useEffect(() => {\n    let tid;\n    if (active) {\n      tid = setTimeout(() => { // redraw clusters\n        if (ref.current !== null && ref.current.leafletElement) {\n          ref.current.leafletElement.refreshClusters();\n        }\n      }, 10);\n    }\n\n    return () => {\n      tid && clearTimeout(tid);\n    };\n  }, [active]);\n\n  if (!coords || !coords.length) {\n    return null;\n  }\n\n  return (<MarkerClusterGroup ref={ref} iconCreateFunction={createClusterCustomIcon}>{\n    coords.map((pos, idx) => (\n      <Marker\n        position={pos}\n        key={''.concat(idx, count, attest, active ? 'force-redraw' : '')}\n        phase={phase}\n        count={count}\n        attest={state.attest}\n        active={active}\n        icon={locationMarker} />))\n  }</MarkerClusterGroup>);\n}\n","import React, { useEffect, useState, useRef, useReducer } from 'react';\nimport { Map as LMap, TileLayer } from 'react-leaflet';\nimport { Sidebar, Responsive, Segment } from 'semantic-ui-react';\nimport * as L from 'leaflet';\nimport * as bs58 from 'bs58';\nimport { u32 as U32 } from '@polkadot/types/primitive';\nimport { u8aToString } from '@polkadot/util';\n\nimport { useSubstrate } from './substrate-lib';\nimport { DeveloperConsole } from './substrate-lib/components';\n\nimport MapMenu from './map/MapMenu';\nimport MapCeremonyPhases from './map/MapCeremonyPhases';\nimport MapNodeInfo from './map/MapNodeInfo';\nimport MapControl from './map/MapControl';\nimport MapSidebar from './map/MapSidebar';\nimport MapNodeSwitchWidget from './map/MapNodeSwitchWidget';\n\nimport { CommunitiesClusters } from './map/CommunitiesClusters';\nimport { LocationsLayer } from './map/LocationsLayer';\nimport { parseI32F32, parseI64F64, batchFetch } from './utils';\n\nimport 'leaflet/dist/leaflet.css';\nimport 'react-leaflet-markercluster/dist/styles.min.css';\n\nconst initialPosition = L.latLng(47.166168, 8.515495);\n\n/// Parse only 16 bits of fractional part\nconst parseLatLng = _ => parseI64F64(_, 16);\n\nconst toLatLng = location => [\n  parseLatLng(location.lat),\n  parseLatLng(location.lon)\n];\n\nconst BLOCKS_PER_MONTH = (86400 / 6) * (356 / 12);\n\nconst parseDemurrage = _ => (1 - Math.exp(-1 * parseI64F64(_) * BLOCKS_PER_MONTH)) * 100;\n\nconst tileSetup = {\n  url: 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',\n  attribution: '&copy; <a href=\"https://www.openstreetmap.org/\">OpenStreetMap</a> contributors, <a href=\"https://creativecommons.org/licenses/by-sa/2.0/\">CC-BY-SA</a>'\n};\n\nconst apiReady = (api, queryName = '') => {\n  const query = api && api.queryMulti && api.query;\n  return query && queryName ? (!!query[queryName]) : !!query;\n};\n\n// Ceremony Phases\nconst ceremonyPhases = {\n  REGISTERING: 0,\n  ASSIGNING: 1,\n  ATTESTING: 2\n};\n\nconst sumUp = obj => Object.keys(obj).reduce((acc, it) => { acc = acc + obj[it]; return acc; }, 0);\n\nconst initialState = {\n  subscribtionCeremony: 0,\n  subscribtionPhase: -1,\n  lastCeremony: {\n    participants: {},\n    meetups: {},\n    attestations: {}\n  },\n  subscribtions: [],\n  participantCount: 0,\n  meetupCount: 0,\n  attestationCount: 0,\n  participants: {},\n  meetups: {},\n  attestations: {}\n};\n\nconst reducer = (state, action) => {\n  switch (action.type) {\n    case 'unsubscribeAll':\n      state.subscribtions.forEach(unsub => unsub());\n      return { ...state, subscribtions: [] };\n\n    case 'subscribe':\n      state.subscribtions.forEach(unsub => unsub());\n      return { ...state, ...action.payload };\n\n    case 'participants':\n      return ((state, action) => {\n        const participants = { ...state.participants, [action.payload.cid]: action.payload.count };\n        const participantCount = sumUp(participants);\n        return { ...state, participants, participantCount };\n      })(state, action);\n\n    case 'meetups':\n      return ((state, action) => {\n        const meetups = { ...state.meetups, [action.payload.cid]: action.payload.count };\n        const meetupCount = sumUp(meetups);\n        return { ...state, meetups, meetupCount };\n      })(state, action);\n\n    case 'attestations':\n      return ((state, action) => {\n        const attestations = { ...state.attestations, [action.payload.cid]: action.payload.count };\n        const attestationCount = sumUp(attestations);\n        return {\n          ...state,\n          attestations,\n          attestationCount\n        };\n      })(state, action);\n\n    case 'last':\n      return {\n        ...state,\n        lastCeremony: action.payload\n      };\n\n    case 'reset':\n      state.subscribtions.forEach(unsub => unsub());\n      if (state.subscribtionCeremony && state.subscribtionCeremony !== state.lastCeremony.subscribtionCeremony) {\n        return {\n          ...initialState,\n          lastCeremony: {\n            subscribtionCeremony: state.subscribtionCeremony,\n            meetups: { ...state.meetups },\n            meetupCount: state.meetupCount,\n            attestations: { ...state.attestations },\n            attestationCount: state.attestationCount,\n            participants: { ...state.participants },\n            participantCount: state.participantCount,\n            subscribtions: null,\n            lastCeremony: null\n          }\n        };\n      } else {\n        return state;\n      }\n\n    default:\n      throw new Error('unknown action '.concat(action.type));\n  }\n};\n\nconst setters = ['participants', 'meetups', 'attestations']; // action names for each phase\n\nexport default function Map (props) {\n  const { debug } = props;\n  const mapRef = useRef();\n  const { api, apiState, socket } = useSubstrate();\n\n  const [ui, setUI] = useState({ selected: '', loading: true, menu: false, nodeSwitch: false });\n  const [cids, setCids] = useState([]);\n  const [hash, setHash] = useState([]);\n  const [data, setData] = useState({});\n  const [position, setPosition] = useState(initialPosition);\n  const [currentPhase, setCurrentPhase] = useState({ phase: -1, timestamp: 0, timer: null });\n  const [ceremonyIndex, setCeremonyIndex] = useState(0);\n  const [state, dispatch] = useReducer(reducer, initialState);\n\n  const ec = api && api.query && (api.query.encointerCommunities||api.query.encointerCurrencies);\n  const es = api && api.query && api.query.encointerScheduler;\n\n  /// Fetch locations for each Community in parallel; Save to state once ready\n  async function fetchGeodataPar (cids, hash) { /* eslint-disable no-multi-spaces */\n    const kvReducer = (acc, data, idx) => { // convert array to key-value map\n      acc[hash[idx]] = data;                // where key is BASE58 of cid\n      return acc;\n    };\n\n    debug && console.log('FETCHING LOCATIONS AND PROPERTIES');\n    const fetcher = ec.communityMetadata || ec.currencyProperties;\n    const [locations, properties] = await Promise.all([\n      await batchFetch(         // Fetching all Locations in parallel\n        ec.locations,           // API: encointerCommunities.locations(cid) -> Vec<Location>\n        cids,                   // array of parameters to method\n        _ => _.map(toLatLng)    // convert Location from I32F32 to LatLng\n      ),                        // Fetching all community Properties\n      await batchFetch(fetcher, cids)]);\n\n    debug && console.log('SETTING DATA', locations, properties);\n\n    setData(cids.map((cid, idx) => ({ // Shape of data in UI\n      cid,                            // cid for back-reference\n      coords: locations[idx],         // all coords\n      position: L.latLngBounds(locations[idx]).getCenter(),\n      demurrage: properties[idx].demurrage_per_block ? parseDemurrage(properties[idx].demurrage_per_block) : 1,\n      demurragePerBlock: properties[idx].demurrage_per_block ? parseI64F64(properties[idx].demurrage_per_block) : 0,\n      name: properties[idx].name_utf8 ? u8aToString(properties[idx].name_utf8) : properties[idx].name\n    })).reduce(kvReducer, {}));\n    setUI({ ...ui, loading: false });\n  }\n\n  /// Update current phase\n  useEffect(() => {\n    let unsub;\n    debug && console.log('phase', currentPhase.phase);\n    if (!apiReady(api, 'encointerScheduler')) {\n      return;\n    }\n\n    const {\n      encointerScheduler: {\n        currentPhase: getCurrentPhase,\n        nextPhaseTimestamp: getNextPhaseTimestamp\n      }\n    } = api.query;\n\n    getCurrentPhase(newPhase => {\n      const phase = newPhase.toNumber();\n      if (currentPhase.phase !== phase) {\n        getNextPhaseTimestamp()\n          .then(newPhaseTimestamp => {\n            const timestamp = newPhaseTimestamp.toNumber();\n            setCurrentPhase({ phase, timestamp });\n          })\n          .catch(console.error);\n      }\n    }).then((unsubscribe) => {\n      unsub = unsubscribe;\n    });\n    return () => {\n      unsub && unsub();\n    };\n  }, [currentPhase.phase, debug, ec, api]);\n\n  /// Update ceremony index once registration phase starts\n  useEffect(() => { /* eslint-disable react-hooks/exhaustive-deps */\n    if (!apiReady(api, 'encointerScheduler')) {\n      return;\n    }\n    const {\n      encointerScheduler: {\n        currentCeremonyIndex: getCurrentCeremonyIndex\n      }\n    } = api.query;\n    debug && console.log('ceremony id', currentPhase.phase, ceremonyIndex);\n    const CommunityCeremony = api.registry.getOrUnknown('CommunityCeremony');\n\n    /// Fetch participants and meetups counters\n    const fetchHistoricData = async (ceremony, phase, cids) => {\n      if (!apiReady(api, 'encointerCeremonies')) {\n        return;\n      }\n      const ceremonyNumber = ceremony.toNumber();\n      if (ceremonyNumber <= state.subscribtionCeremony && phase === 0) {\n        return;\n      }\n      const {\n        encointerCeremonies: {\n          participantCount: getParticipantCount,\n          meetupCount: getMeetupCount\n        }\n      } = api.query;\n      // Previous Phases of current Ceremony\n      for (let oldPhase = 0; oldPhase < phase; oldPhase++) {\n        cids.forEach(cid => {\n          const communityCeremony = new CommunityCeremony(api.registry, [cid, ceremony]);\n          const getters = [getParticipantCount, getMeetupCount];\n          const getter = getters[oldPhase];\n          debug && console.log('hist ', bs58.encode(cid), ceremony.toNumber(), oldPhase);\n          getter(communityCeremony).then((_) => dispatch({\n            type: setters[oldPhase],\n            payload: {\n              cid: bs58.encode(cid),\n              count: _.toNumber()\n            }\n          }));\n        });\n      }\n    };\n\n    /// Fetch participants and meetups counters\n    const fetchLastCeremony = async (ceremony, cids) => {\n      if (!apiReady(api, 'encointerCeremonies')) {\n        return;\n      }\n      const {\n        encointerCeremonies: {\n          participantCount: getParticipantCount,\n          meetupCount: getMeetupCount\n        }\n      } = api.query;\n      // Last Ceremony\n      const lastCeremony = ceremony.sub(new U32(api.registry, 1));\n      const lastCeremonyData = await Promise.all(cids.map(cid => {\n        const communityCeremony = new CommunityCeremony(api.registry, [cid, lastCeremony]);\n        return api.queryMulti([\n          [getParticipantCount, communityCeremony],\n          [getMeetupCount, communityCeremony]\n        ]);\n      }));\n      const payload = lastCeremonyData.reduce((acc, data, idx) => {\n        const cid = bs58.encode(cids[idx]);\n        const [participantCount, meetupCount] = data;\n        acc.meetups[cid] = meetupCount.toNumber();\n        acc.participants[cid] = participantCount.toNumber();\n        acc.participantCount = acc.participants[cid] + acc.participantCount;\n        acc.meetupCount = acc.meetups[cid] + acc.meetupCount;\n        return acc;\n      }, {\n        subscribtionCeremony: lastCeremony.toNumber(),\n        meetups: {},\n        participants: {},\n        participantCount: 0,\n        meetupCount: 0\n      });\n      dispatch({\n        type: 'last',\n        payload\n      });\n    };\n\n    /// Subscription management via reducer\n    const subscribeToUpdates = async function (ceremony, phase, cids) {\n      if (!apiReady(api, 'encointerCeremonies')) {\n        return;\n      }\n      const ceremonyNumber = ceremony.toNumber();\n      if (ceremonyNumber <= state.subscribtionCeremony && phase <= state.subscribtionPhase) {\n        return;\n      }\n\n      debug && console.log('subscribe to ceremony', ceremonyNumber, phase);\n      const {\n        encointerCeremonies: {\n          participantCount: getParticipantCount,\n          attestationCount: getAttestationCount,\n          meetupCount: getMeetupCount\n        }\n      } = api.query;\n      const getters = [getParticipantCount, getMeetupCount, getAttestationCount];\n      const CommunityCeremony = api.registry.getOrUnknown('CommunityCeremony');\n      const unsubs = await Promise.all(cids.map(cid => {\n        const communityCeremony = new CommunityCeremony(api.registry, [cid, ceremonyIndex]);\n        const getter = getters[phase];\n        return getter(communityCeremony, (_) => dispatch({\n          type: setters[phase],\n          payload: {\n            cid: bs58.encode(cid),\n            count: _.toNumber()\n          }\n        }));\n      }));\n\n      dispatch({\n        type: 'subscribe',\n        payload: {\n          subscribtions: unsubs,\n          subscribtionCeremony: ceremonyNumber,\n          subscribtionPhase: phase\n        }\n      });\n    };\n\n    if (!ceremonyIndex) {\n      getCurrentCeremonyIndex().then((currentCeremonyIndex) => {\n        debug && console.log('set ceremonyIndex', currentCeremonyIndex.toString());\n        setCeremonyIndex(currentCeremonyIndex);\n      });\n    } else if (currentPhase.phase !== -1 &&\n        (currentPhase.phase !== state.subscribtionPhase ||\n         ceremonyIndex.toNumber() !== state.subscribtionCeremony) &&\n        cids.length) {\n      subscribeToUpdates(ceremonyIndex, currentPhase.phase, cids);\n      fetchHistoricData(ceremonyIndex, currentPhase.phase, cids);\n      !state.lastCeremony.subscribtionCeremony && fetchLastCeremony(ceremonyIndex, cids);\n    }\n    if (currentPhase.phase === ceremonyPhases.REGISTERING) {\n      state.subscribtionCeremony !== state.lastCeremony.subscribtionCeremony &&\n        dispatch({ type: 'reset' }); // reset state on start of new ceremony\n      getCurrentCeremonyIndex().then((currentCeremonyIndex) => {\n        debug && console.log('set ceremonyIndex', currentCeremonyIndex.toString());\n        setCeremonyIndex(currentCeremonyIndex);\n      });\n    }\n  }, [currentPhase.phase, ceremonyIndex]);\n\n  /// Load communities identifiers once\n  useEffect(() => {\n    debug && console.log('cids', cids);\n\n    if (ec && cids.length === 0) {\n      const getter = ec.communityIdentifiers || ec.currencyIdentifiers;\n      getter().then(cids => {\n          const hashes = cids.map(bs58.encode);\n          setCids(cids);\n          setHash(hashes);\n        })\n        .catch(err => console.error(err));\n    }\n  }, [cids, debug, ec]);\n\n  /// Get locations effect\n  useEffect(() => { /* eslint-disable react-hooks/exhaustive-deps */\n    debug && console.log('get locations');\n    if (cids.length && cids.length === hash.length) {\n      fetchGeodataPar(cids, hash);\n    }\n  }, [cids, hash]);\n\n  /// Attempt geolocation\n  useEffect(() => {\n    debug && console.log('get position');\n    const map = mapRef.current;\n    if (map != null && position === initialPosition) {\n      map.leafletElement.locate();\n    }\n  }, [mapRef, position]);\n\n  /// Update map after resize\n  useEffect(() => {\n    debug && console.log('update resize');\n    const map = mapRef.current && mapRef.current.leafletElement;\n    map && setTimeout(_ => map.invalidateSize(), 50);\n  }, [ui.sidebarSize]);\n\n  /// Handler generator for zoom in/out\n  function handlerZoom (s) {\n    return () => mapRef.current.leafletElement[s < 0 ? 'zoomOut' : 'zoomIn']();\n  }\n\n  /// Resize leaflet map when sidebar shown\n  function calcMapOffset () {\n    const full = '100%';\n    // should reposition markers in portrait mode if sidebar shown\n    if (ui.portrait && ui.selected && ui.sidebarSize && mapRef.current !== null) {\n      if (mapRef.current.container.style.height === '100%') {\n        const offset = mapRef.current.container.offsetHeight - ui.sidebarSize;\n        return `${offset}px`;\n      } else {\n        return mapRef.current.container.style.height;\n      }\n    }\n    return full;\n  }\n\n  /// Reset marker to my position\n  const handleLocationFound = e => {\n    setPosition(e.latlng);\n    const map = mapRef.current.leafletElement;\n    map.flyTo(e.latlng);\n    map.setZoom(8);\n  };\n\n  /// Handler for click on Community marker\n  const handleCommunityMarkerClick = cid => {\n    const map = mapRef.current.leafletElement;\n    setUI({ ...ui, selected: cid, prevZoom: map.getZoom() });\n    const bounds = L.latLngBounds(data[cid].coords).pad(2);\n    map.fitBounds(bounds);\n  };\n\n  /// Handler for window resize\n  const handleResponsibleUpdate = (_, { width }) =>\n    setUI({ ...ui, portrait: width < Responsive.onlyMobile.maxWidth, width });\n\n  /// Handler for sidebar closing\n  const handleSidebarClosed = () => {\n    const map = mapRef.current.leafletElement;\n    map.setZoom(ui.prevZoom);\n    setUI({ ...ui, selected: '', sidebarSize: 0 });\n  };\n\n  /// Handler for sidebar shows completely\n  const handleSidebarShow = sidebarSize =>\n    setUI({ ...ui, sidebarSize, menu: false, nodeSwitch: false });\n\n  /// Show left side menu\n  const toggleMenu = () => setUI({\n    ...ui,\n    menu: !ui.menu,\n    selected: ui.menu ? ui.selected : '',\n    sidebarSize: ui.menu ? ui.sidebarSize : 0\n  });\n\n  /// Close left side menu if clicked\n  const handleMapClick = () =>\n    ui.menu && setUI({ ...ui, menu: false, nodeSwitch: false });\n\n  /// Open node switch widget\n  const handleClickNode = () =>\n    !ui.nodeSwitch && setUI({ ...ui, nodeSwitch: true });\n  const handleNodeSwitchClose = () => setUI({ ...ui, nodeSwitch: false });\n\n  return (\n    <Responsive\n      as={Segment.Group}\n      className='encointer-map'\n      fireOnMount\n      onUpdate={handleResponsibleUpdate}>\n\n      <Sidebar.Pushable as={Segment}  className='component-wrapper'>\n\n        <MapMenu visible={ui.menu} />\n\n        <MapNodeSwitchWidget\n          socket={socket}\n          visible={ui.nodeSwitch}\n          onClose={handleNodeSwitchClose}\n        />\n\n        <MapSidebar\n          api={api}\n          apiState={apiState}\n          onClose={handleSidebarClosed}\n          onShow={handleSidebarShow}\n          hash={ui.selected}\n          direction={ui.portrait ? 'bottom' : 'right'}\n          width='very wide'\n          data={data[ui.selected] || {}}\n          participantCount={ui.selected ? (state.participants[ui.selected] || 0) : 0}\n          lastParticipantCount={ui.selected ? state.lastCeremony.participants[ui.selected] : 0}\n          meetupCount={ui.selected ? (state.meetups[ui.selected] || 0) : 0}\n          lastMeetupCount={ui.selected ? state.lastCeremony.meetups[ui.selected] : 0}\n          debug={debug}\n        />\n\n        <Sidebar.Pusher className='encointer-map-wrapper'\n          style={{ marginRight: ui.portrait ? '0' : ui.sidebarSize + 'px' }}>\n\n          <MapCeremonyPhases\n            small={ui.portrait}\n            participantCount={state.participantCount}\n            meetupCount={state.meetupCount}\n            attestationCount={state.attestationCount}\n            currentPhase={currentPhase} />\n\n          <MapNodeInfo\n            api={api}\n            apiState={apiState}\n            onClickNode={handleClickNode}\n            style={ui.portrait && ui.selected ? { display: 'none' } : {}} />\n\n          <MapControl\n            onClick={toggleMenu}\n            loading={ui.loading}\n            onZoomIn={handlerZoom(1)}\n            onZoomOut={handlerZoom(-1)} />\n\n          <LMap\n            center={position}\n            zoom={4}\n            ref={mapRef}\n            zoomControl={false}\n            touchZoom={true}\n            onClick={handleMapClick}\n            style={{ height: calcMapOffset() }}\n            onLocationFound={handleLocationFound}>\n\n            <TileLayer {...tileSetup} />\n\n            { ui.selected\n              ? <LocationsLayer\n                participantCount={ui.selected ? (state.participants[ui.selected] || 0) : 0}\n                meetupCount={ui.selected ? (state.meetups[ui.selected] || 0) : 0}\n                attestationCount={ui.selected ? (state.attestations[ui.selected] || 0) : 0}\n                phase={currentPhase.phase}\n                data={data[ui.selected]}\n              />\n              : null }\n\n            { !ui.loading\n              ? <CommunitiesClusters\n                data={data}\n                cids={hash}\n                state={state}\n                onClick={handleCommunityMarkerClick}\n                selected={ui.selected} />\n              : null }\n\n          </LMap>\n\n        </Sidebar.Pusher>\n\n      </Sidebar.Pushable>\n\n      { (debug && apiState === 'READY')\n        ? <DeveloperConsole />\n        : null }\n\n    </Responsive>\n  );\n}\n","import React from 'react';\n\nimport 'semantic-ui-css/semantic.min.css';\nimport { SubstrateContextProvider } from './substrate-lib';\n\nimport Map from './Map';\nimport './style.css';\n\nfunction Main () {\n  return (<Map debug />);\n}\n\nexport default function App () {\n  return (\n    <SubstrateContextProvider>\n      <Main />\n    </SubstrateContextProvider>\n  );\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\n\nimport App from './App';\n\nReactDOM.render(<App />,\n  document.getElementById('root')\n);\n"],"sourceRoot":""}
(this.webpackJsonpexplorer=this.webpackJsonpexplorer||[]).push([[0],{1045:function(e,t){},1176:function(e){e.exports=JSON.parse('{"PROVIDER_SOCKET":"wss://gesell.encointer.org"}')},1320:function(e,t,n){},1321:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),c=n(89),o=n.n(c),i=(n(582),n(27)),u=n(19),s=n.n(u),l=n(45),p=n(49),m=n(345),f=n(204),d=n(346),b=n.n(d),y=n(555),E=n(1176),h=["REACT_APP_PROVIDER_SOCKET","REACT_APP_DEVELOPMENT_KEYRING"].reduce((function(e,t){return void 0!==Object({NODE_ENV:"production",PUBLIC_URL:""})[t]&&(e[t.slice(10)]=Object({NODE_ENV:"production",PUBLIC_URL:""})[t]),e}),{}),C=Object(i.a)({},y,{},E,{},h),v=n(556),g=n.n(v).a.parse(window.location.search).rpc||C.PROVIDER_SOCKET;console.log("Connected socket: ".concat(g));var O={socket:g,types:C.CUSTOM_TYPES,keyring:null,keyringState:null,api:null,apiState:null},j=function(e,t){var n=null;switch(t.type){case"RESET_SOCKET":return n=t.payload||e.socket,Object(i.a)({},e,{socket:n,api:null,apiState:null});case"CONNECT":return Object(i.a)({},e,{api:t.payload,apiState:"CONNECTING"});case"CONNECT_SUCCESS":return Object(i.a)({},e,{apiState:"READY"});case"CONNECT_ERROR":return Object(i.a)({},e,{apiState:"ERROR"});case"SET_KEYRING":return Object(i.a)({},e,{keyring:t.payload,keyringState:"READY"});case"KEYRING_ERROR":return Object(i.a)({},e,{keyring:null,keyringState:"ERROR"});default:throw new Error("Unknown type: ".concat(t.type))}},S=r.a.createContext(),I=function(e){var t=Object(i.a)({},O);["socket","types"].forEach((function(n){t[n]="undefined"===typeof e[n]?t[n]:e[n]}));var n=Object(a.useReducer)(j,t),c=Object(p.a)(n,2),o=c[0],u=c[1];return r.a.createElement(S.Provider,{value:[o,u]},e.children)},k=function(){var e=Object(a.useContext)(S),t=Object(p.a)(e,2),n=t[0],r=t[1],c=n.api,o=n.socket,u=n.types,d=Object(a.useCallback)(Object(l.a)(s.a.mark((function e(){var t,n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=2;break}return e.abrupt("return");case 2:t=new m.WsProvider(o),(n=new m.ApiPromise({provider:t,types:u})).on("connected",(function(){r({type:"CONNECT",payload:n}),n.isReady.then((function(e){return r({type:"CONNECT_SUCCESS"})}))})),n.on("ready",(function(){return r({type:"CONNECT_SUCCESS"})})),n.on("error",(function(){return r({type:"CONNECT_ERROR"})}));case 7:case"end":return e.stop()}}),e)}))),[c,o,u,r]),y=n.keyringState,E=Object(a.useCallback)(Object(l.a)(s.a.mark((function e(){var t;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!y){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,e.next=5,Object(f.web3Enable)(C.APP_NAME);case 5:return e.next=7,Object(f.web3Accounts)();case 7:t=(t=e.sent).map((function(e){var t=e.address,n=e.meta;return{address:t,meta:Object(i.a)({},n,{name:"".concat(n.name," (").concat(n.source,")")})}})),b.a.loadAll({isDevelopment:C.DEVELOPMENT_KEYRING},t),r({type:"SET_KEYRING",payload:b.a}),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error(e.t0),r({type:"KEYRING_ERROR"});case 17:case"end":return e.stop()}}),e,null,[[2,13]])}))),[y,r]);return Object(a.useEffect)((function(){d()}),[d]),Object(a.useEffect)((function(){E()}),[E]),Object(i.a)({},n,{dispatch:r})},w=n(266),N=n.n(w),T=n(267),x=n.n(T),R=(x()(N.a),n(172)),P=n(549),_=n(551),A=n(1336),D=n(1335),z=n(1331),M=n(23),q=n(110),G=n(340);function L(e){var t=k().api;return window.api=t,window.util=n(3),window.util_crypto=n(46),window.keyring=n(215),null}n(276);var B=n(1333);var U=n(1332),Y=n(120);var V=r.a.memo((function(e){return r.a.createElement(z.a,{as:U.a,animation:"overlay",direction:"left",icon:"labeled",inverted:!0,vertical:!0,visible:e.visible,width:"thin"},r.a.createElement(U.a.Item,{as:"a",href:"//encointer.org",target:"_blank"},r.a.createElement(Y.a,{name:"book"}),"Documentation"),r.a.createElement(U.a.Item,{as:"a",href:"//encointer.org/testnet/",target:"_blank"},r.a.createElement(Y.a,{name:"block layout"}),"Testnet"),r.a.createElement(U.a.Item,{as:"a",href:"//encointer.org/blog/",target:"_blank"},r.a.createElement(Y.a,{name:"newspaper"}),"Blog"),r.a.createElement(U.a.Item,{as:"a",href:"//encointer.org/faq/",target:"_blank"},r.a.createElement(Y.a,{name:"question circle"}),"FAQ"),r.a.createElement(U.a.Item,{as:"a",href:"//encointer.org/donate/",target:"_blank"},r.a.createElement(Y.a,{name:"dollar"}),"Donate"),r.a.createElement(U.a.Item,{as:"a",href:"//encointer.org/about/",target:"_blank"},r.a.createElement(Y.a,{name:"favorite"}),"About"),r.a.createElement(U.a.Item,{as:"a",href:"//github.com/encointer/encointer-node",target:"_blank"},r.a.createElement(Y.a,{name:"github"}),"Code"))}),(function(e,t){return e.visible===t.visible})),F=n(1329),K=n(273),Z=function(e){var t=(e-Date.now())/1e3|0;if(t>=0){var n=t%60,a=t/60|0,r=a/60|0,c=r/24|0;r>0&&(a%=60),c>0&&(r%=24);var o=c?c.toString().concat("d "):"",i=r.toString().padStart(2,"0"),u=a.toString().padStart(2,"0"),s=n.toString().padStart(2,"0");return"".concat(o).concat(i,":").concat(u,":").concat(s)}return"finished"};function H(e){var t=e.nextPhaseTimestamp,n=Object(a.useState)(""),c=Object(p.a)(n,2),o=c[0],i=c[1];return Object(a.useEffect)((function(){i(Z(t));var e=setInterval((function(){i(Z(t))}),1e3);return function(){return clearInterval(e)}}),[t]),r.a.createElement(r.a.Fragment,null,o)}var J=["REGISTERING","ASSIGNING","ATTESTING"],W=function(e){return r.a.createElement("div",null,r.a.createElement("div",null,"starting at:")," ",function(e){return new Date(e).toLocaleString()}(e))},Q=r.a.memo((function(e){var t=e.small,n=e.participantCount,a=e.meetupCount,c=e.attestationCount,o=e.currentPhase,i=o.phase,u=o.timestamp,s=[n,a,c];return r.a.createElement("div",{className:"encointer-map-ceremony-phase"},r.a.createElement(F.a.Group,{ordered:!0,unstackable:!0,className:[J[i],t?"small-screen":""].join(" "),size:"mini"},function(e){var n=(-1===i?[]:J).map((function(e,t){return{key:J[t],counter:s[t],active:t===i,className:"step-".concat(J[t]).toLowerCase()}})).filter((function(e,n){return!t||e.active||n===i+1||0===n&&2===i}));return t&&2===i?n.reverse():n}().map((function(e,n){return r.a.createElement(F.a,e,r.a.createElement(F.a.Content,null,r.a.createElement(F.a.Title,null,e.key," ",n<=i&&e.counter?r.a.createElement(K.a,{circular:!0,color:e.active?"green":"grey"},e.counter):null),r.a.createElement(F.a.Description,null,e.active?r.a.createElement("div",null,r.a.createElement("div",null,"time left: "),r.a.createElement(H,{nextPhaseTimestamp:u})):t||n===i+1||0===n&&2===i?W(u):null)))}))))}),(function(e,t){return t.small===e.small&&t.participantCount===e.participantCount&&t.meetupCount===e.meetupCount&&t.attestationCount===e.attestationCount&&t.currentPhase.phase===e.currentPhase.phase&&t.currentPhase.timestamp===e.currentPhase.timestamp})),$=n(1328),X=n(1325),ee=r.a.memo((function(e){var t=k().api,n=Object(a.useState)(0),c=Object(p.a)(n,2),o=c[0],i=c[1],u=e.finalized?t.derive.chain.bestNumberFinalized:t.derive.chain.bestNumber;return Object(a.useEffect)((function(){var e;return u((function(e){i(e.toNumber())})).then((function(t){e=t})).catch(console.error),function(){return e&&e()}}),[u]),r.a.createElement(r.a.Fragment,null,o)}),(function(e){return!0})),te=r.a.memo((function(e){var t=k().api.query.encointerScheduler.currentCeremonyIndex,n=Object(a.useState)(0),c=Object(p.a)(n,2),o=c[0],i=c[1];return Object(a.useEffect)((function(){var e;return t((function(e){i(e.toNumber())})).then((function(t){e=t})).catch(console.error),function(){return e&&e()}}),[t]),o?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"ceremony")," ",r.a.createElement("strong",null," #",o)):null}),(function(e){return!0}));function ne(e){var t=k(),n=t.apiState,c=t.api,o=Object(a.useState)({}),i=Object(p.a)(o,2),u=i[0],m=i[1],f=c&&c.rpc&&c.rpc.system,d=c&&c.query&&c.query.encointerScheduler&&c.query.encointerScheduler.currentCeremonyIndex;return Object(a.useEffect)((function(){f&&function(){var e=Object(l.a)(s.a.mark((function e(){var t,n,a,r,c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([f.chain(),f.name(),f.version()]);case 3:t=e.sent,n=Object(p.a)(t,3),a=n[0],r=n[1],c=n[2],m({chain:a,nodeName:r,nodeVersion:c}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}()()}),[f]),r.a.createElement($.a,{className:"encointer-map-node-info",style:e.style||{}},"READY"===n?r.a.createElement(r.a.Fragment,null,r.a.createElement($.a.Content,{className:"info"},r.a.createElement($.a.Header,null,u.nodeName),r.a.createElement($.a.Meta,null,"".concat(u.chain||""," v").concat(u.nodeVersion))),r.a.createElement($.a.Content,{className:"blocks"},d?r.a.createElement(r.a.Fragment,null,r.a.createElement($.a.Meta,null),r.a.createElement("div",{className:"block-current"},"current block #",r.a.createElement(ee,null)),r.a.createElement("div",{className:"finalized-current"},"finalized block #",r.a.createElement(ee,{finalized:!0})),r.a.createElement("div",{className:"ceremony"},r.a.createElement(te,null))):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"loading"},r.a.createElement(X.a,{active:!0,size:"medium",inline:"centered"}))))):r.a.createElement($.a.Content,{className:"loading"},"ERROR"!==n?r.a.createElement($.a.Meta,null,r.a.createElement(X.a,{active:!0,size:"small",inline:!0})," Connecting to the blockchain"):r.a.createElement($.a.Meta,{className:"error"},"Error connecting to the blockchain")))}function ae(e){return r.a.createElement(ne,e)}var re=r.a.memo((function(e){var t=e.loading,n=e.onZoomIn,a=e.onZoomOut,c=e.onClick;return r.a.createElement(U.a,{className:"encointer-map-floating-widgets",stackable:!0,size:"mini",vertical:!0},r.a.createElement(U.a.Item,null,r.a.createElement(B.a,{onClick:c,loading:t,disabled:t,icon:"sidebar",className:"encoiner-menu-button"})),r.a.createElement(U.a.Item,null,r.a.createElement(B.a.Group,{vertical:!0,compact:!0,size:"small"},r.a.createElement(B.a,{icon:"plus",onClick:n}),r.a.createElement(B.a,{icon:"minus",onClick:a}))))}),(function(e,t){return e.loading===t.loading})),ce=n(1334),oe=n(1330),ie=n(1327),ue=n(207),se=n.n(ue);function le(e,t){var n=e+t;return se()(n>=8,"Bit length can't be less than 8, provided ".concat(n)),se()(n<=128,"Bit length can't be bigger than 128, provided ".concat(n)),se()(!(n&n-1),"Bit length should be power of 2, provided ".concat(n)),function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;se()(e.bitLength()===n,"Bit length is not equal to "+n);var r=e.toString(2,n),c=(t>r.length?r.padStart(t,"0"):r).slice(-t,-1*(t-a)||void 0),o=c.split("").reduce((function(e,t,n){return e+="1"===t?1/Math.pow(2,n+1):0}),0),i=r.slice(0,-t),u=i?parseInt(i,2):0;return u+(e.negative?-o:o)}}le(4,4),le(8,8),le(16,16);var pe=le(32,32),me=le(64,64);function fe(e,t,n){var a=e;return t&&(a=a.map(t)),n&&(a=a.reduce(n,{})),a}function de(e,t,n,a){return be.apply(this,arguments)}function be(){return(be=Object(l.a)(s.a.mark((function e(t,n,a,r){var c;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map((function(e){return t(e)})));case 2:return c=e.sent,e.abrupt("return",fe(c,a,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ye=x()(N.a);function Ee(e){var t=e.debug,n=e.onClose,c=e.onShow,o=e.hash,i=e.direction,u=e.width,s=e.participantCount,l=e.lastParticipantCount,m=e.lastMeetupCount,f=e.meetupCount,d=e.data,b=d.name,y=d.cid,E=d.demurrage,h=!!o.length,C=Object(a.useRef)(),v="top"===i||"bottom"===i,g=k().api,O=Object(a.useState)([]),j=Object(p.a)(O,2),S=j[0],I=j[1],w=Object(a.useState)(null),N=Object(p.a)(w,2),T=N[0],x=N[1];Object(a.useEffect)((function(){y&&g.query.encointerCurrencies&&(t&&console.log("GETTING BOOTSTRAPPERS",y),g.query.encointerCurrencies.bootstrappers(y).then((function(e){t&&console.log("BOOTSTRAPPERS RECEIVED",e),I(e.toJSON())})))}),[g.query.encointerCurrencies,y,t]),Object(a.useEffect)((function(){y&&g.query.encointerBalances&&(t&&console.log("GETTING MONEYSUPPLY",y),g.query.encointerBalances.totalIssuance(y).then((function(e){t&&console.log("MONEYSUPPLY RECEIVED",e),x(me(e.get("principal")))})))}),[g.query.encointerBalances,y,t]);return r.a.createElement(z.a,{className:"details-sidebar",ref:C,as:D.a.Group,animation:"overlay",icon:"labeled",direction:i,visible:h,width:u,onShow:function(){return C.current&&c(C.current.ref.current["offset".concat(v?"Height":"Width")])}},r.a.createElement(D.a,{padded:!0},r.a.createElement(ce.a,null,r.a.createElement(Y.a,{name:"money bill alternate"}),r.a.createElement(ce.a.Content,null,"Currency info"))),r.a.createElement(D.a,{textAlign:"center"},r.a.createElement(ce.a,{sub:!0,textAlign:"left"},"Currency ID:"),r.a.createElement(oe.a,{size:"small",color:"blue"},o),r.a.createElement("p",null,b)),r.a.createElement(D.a.Group,null,r.a.createElement(D.a.Group,{horizontal:!0},r.a.createElement(D.a,null,r.a.createElement(ce.a,{sub:!0},"Demurrage rate (per month):"),E&&E.toFixed(2),"%",r.a.createElement(ce.a,{sub:!0},"participants registered:"),s,r.a.createElement(ce.a,{sub:!0},"participants registered in last ceremony:"),l),r.a.createElement(D.a,null,r.a.createElement(ce.a,{sub:!0},"Money supply:"),r.a.createElement("p",null,T&&new ye(T).toFormat(2)),r.a.createElement(ce.a,{sub:!0},"meetups assigned:"),f,r.a.createElement(ce.a,{sub:!0},"meetups assigned in last ceremony:"),m)),r.a.createElement(D.a,{loading:!S.length,stacked:!0},r.a.createElement(ce.a,{sub:!0},"List of bootstrappers:"),r.a.createElement(ie.a,null,S.map((function(e){return r.a.createElement(ie.a.Item,{key:e},e)}))))),r.a.createElement(D.a,{textAlign:"right",className:"map-sidebar-close"},r.a.createElement(B.a,{content:"Close",icon:"angle "+(v?"down":"right"),labelPosition:"right",onClick:n})))}var he=r.a.memo((function(e){var t=k().api;return t&&t.query?r.a.createElement(Ee,e):null}),(function(e,t){return e.hash===t.hash&&(!t.hash||e.participantCount===t.participantCount&&e.lastParticipantCount===t.lastParticipantCount&&e.meetupCount===t.meetupCount&&e.lastMeetupCount===t.lastMeetupCount)})),Ce=n(550),ve=n(552),ge=n(270),Oe=n.n(ge),je=M.divIcon,Se="marker-cluster marker-cluster-small ".concat("encoiner-community-icon"),Ie="marker-cluster marker-cluster-small ".concat("encoiner-cluster-custom"),ke=[40,40],we=function(e,t){return new je({iconSize:ke,className:"".concat(e),html:"<div><span>".concat(t,"</span></div>")})},Ne=function(e){return we(Se.concat(" ",e),"$")},Te=function(e,t){return we(Ie.concat(" ",e),t)},xe=Ne(""),Re=Ne("pulse"),Pe=Ne("yellow pulse"),_e=Ne("yellow"),Ae=Ne("red"),De=new M.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),ze=function(e,t,n){var a;return a=0===e?t?"green":"yellow":0!==t?t>1?"green":"yellow":"red",n?a.concat(" pulse"):a},Me=[40,40],qe={"green pulse":Re,"yellow pulse":Pe,"red pulse":Pe,green:xe,yellow:_e,red:Ae},Ge=function(e,t,n){var a=ze(e,t,n);return qe[a]},Le=function(e){var t=e.getAllChildMarkers(),n=t[0].options.phase,a=t.map((function(e){return e.options.count})).reduce((function(e,t){return t>e?t:e}),0),r=t.map((function(e){return e.options.active})).reduce((function(e,t){return t||e}),!1),c=ze(n,a,r),o=e.getChildCount();return Te(c,o)},Be={timers:{},byCID:{},phase:-1},Ue=function(e,t){switch(t.type){case"initialize":return function(e,t){var n=t.payload,a=n.phase,r=n.byCID;return Object(i.a)({},e,{byCID:r,phase:a})}(e,t);case"phase":return Object(i.a)({},e,{phase:t.payload});case"reset":return function(e,t){var n=t.payload,a=n.phase,r=n.byCID,c=Object(i.a)({},e.byCID);for(var o in c)c[o].count=r[o]||0;return Object(i.a)({},e,{byCID:c,phase:a})}(e,t);case"activate":return function(e,t){var n=t.payload,a=n.timers,r=Object(i.a)({},e.byCID,{},n.byCID);for(var c in a)e.timers[c]&&clearTimeout(e.timers[c]);return Object(i.a)({},e,{byCID:r,timers:Object(i.a)({},e.timers,{},a)})}(e,t);case"deactivate":return function(e,t){var n=t.payload,a=Object(i.a)({},e.byCID),r=Object(i.a)({},e.timers);return a[n]=Object(i.a)({},a[n],{active:!1}),clearTimeout(r[n]),r[n]=0,Object(i.a)({},e,{byCID:a,timers:r})}(e,t);default:return e}};function Ye(e){var t=e.cids,n=e.data,c=e.selected,o=e.state,i=Object(a.useReducer)(Ue,Be),u=Object(p.a)(i,2),s=u[0],l=u[1],m=Object(a.useRef)(null),f=o.subscribtionPhase,d=o[["participants","meetups","meetups"][f]],b=o.attestations,y=s.byCID;if(-1===s.phase&&-1!==f){var E=t.map((function(e){var t=n[e],a=t.position,r=t.name,c=o.meetups[e]||0;return{name:r,key:e,position:a,active:!1,count:f?c:d[e]||0,attests:2===f&&b[e]||0}})).reduce((function(e,t){return e[t.key]=t,e}),{});l({type:"initialize",payload:{byCID:E,phase:f}})}else(f>s.phase||0===f&&2===s.phase)&&l({type:"reset",payload:{byCID:d,phase:f}});return Object(a.useEffect)((function(){var e={},n={};t.forEach((function(t){var a=d&&d[t]||0,r=b?b[t]:0;s.byCID[t]&&(s.byCID[t].count<a||s.byCID[t].attests<r)&&(e[t]=s.byCID[t],e[t].count=a,e[t].attests=b[t]||0,e[t].active=!0,n[t]=setTimeout((function(){l({type:"deactivate",payload:t})}),3e3))})),l({type:"activate",payload:{byCID:e,timers:n}})}),[d,b,t]),Object(a.useEffect)((function(){var e,t=[];for(var n in s.byCID)s.byCID[n].active&&t.push(n);return t.length&&(e=setTimeout((function(){null!==m.current&&m.current.leafletElement&&m.current.leafletElement.refreshClusters()}),10)),function(){e&&clearTimeout(e)}}),[y]),r.a.createElement(Oe.a,{ref:m,onClick:function(t){return t.sourceTarget.options.alt&&e.onClick(t.sourceTarget.options.alt)},iconCreateFunction:Le,chunkedLoading:!0},t.map((function(e){var t=n[e],a=t.position,o=t.name,i=y[e]||{},u=i.active,l=i.count,p=i.attests;return c===e?null:r.a.createElement(Ce.a,{key:e.concat(f,p,l,u?"force-redraw":""),position:a,alt:e,count:l,active:u,phase:f,attests:p,icon:Ge(s.phase,l,u)},r.a.createElement(ve.a,{direction:"top",offset:[0,Me[1]/-2]},o))})))}var Ve=function(e){var t=e.getAllChildMarkers(),n=t[0].options.phase,a=t[0].options.count,r=t[0].options.active,c=t.length;return Te(ze(n,a,r),c)},Fe=function(e,t){switch(t.type){case"reset":return{active:!1,count:0,attest:0,timeout:e.timeout};case"activate":return function(e,t){var n=t.payload,a=n.count,r=n.timeout,c=n.attest;return Object(i.a)({},e,{active:!0,count:a,attest:c,timeout:r})}(e,t);case"deactivate":return function(e,t){return clearTimeout(e.timeout),Object(i.a)({},e,{active:!1})}(e);default:return e}};function Ke(e){var t=e.phase,n=e.meetupCount,c=e.participantCount,o=e.attestationCount,i=e.data.coords,u=Object(a.useRef)(null),s=0===t?c:n,l=Object(a.useReducer)(Fe,{active:!1,count:s,attest:o}),m=Object(p.a)(l,2),f=m[0],d=m[1],b=f.active;return Object(a.useEffect)((function(){if(0===s&&0===t&&(f.attest>0||f.count>0))d({type:"reset"});else if(f.count<s||f.attest<o){var e=setTimeout((function(){d({type:"deactivate"})}),3e3);d({type:"activate",payload:{count:s,timeout:e,attest:o}})}}),[f,s,o,t]),Object(a.useEffect)((function(){var e;return b&&(e=setTimeout((function(){null!==u.current&&u.current.leafletElement&&u.current.leafletElement.refreshClusters()}),10)),function(){e&&clearTimeout(e)}}),[b]),i&&i.length?r.a.createElement(Oe.a,{ref:u,iconCreateFunction:Ve},i.map((function(e,n){return r.a.createElement(Ce.a,{position:e,key:"".concat(n,s,o,b?"force-redraw":""),phase:t,count:s,attest:f.attest,active:b,icon:De})}))):null}n(1318),n(1319);var Ze=M.latLng(47.166168,8.515495),He=function(e){return pe(e,16)},Je=function(e){return[He(e.lat),He(e.lon)]},We=function(e){return 100*(1-Math.exp(-1*me(e)*427200))},Qe={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'},$e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e&&e.queryMulti&&e.query;return n&&t?!!n[t]:!!n},Xe=0,et=function(e){return Object.keys(e).reduce((function(t,n){return t+=e[n]}),0)},tt={subscribtionCeremony:0,subscribtionPhase:-1,lastCeremony:{participants:{},meetups:{},attestations:{}},subscribtions:[],participantCount:0,meetupCount:0,attestationCount:0,participants:{},meetups:{},attestations:{}},nt=function(e,t){switch(t.type){case"unsubscribeAll":return e.subscribtions.forEach((function(e){return e()})),Object(i.a)({},e,{subscribtions:[]});case"subscribe":return e.subscribtions.forEach((function(e){return e()})),Object(i.a)({},e,{},t.payload);case"participants":return function(e,t){var n=Object(i.a)({},e.participants,Object(R.a)({},t.payload.cid,t.payload.count)),a=et(n);return Object(i.a)({},e,{participants:n,participantCount:a})}(e,t);case"meetups":return function(e,t){var n=Object(i.a)({},e.meetups,Object(R.a)({},t.payload.cid,t.payload.count)),a=et(n);return Object(i.a)({},e,{meetups:n,meetupCount:a})}(e,t);case"attestations":return function(e,t){var n=Object(i.a)({},e.attestations,Object(R.a)({},t.payload.cid,t.payload.count)),a=et(n);return Object(i.a)({},e,{attestations:n,attestationCount:a})}(e,t);case"last":return Object(i.a)({},e,{lastCeremony:t.payload});case"reset":return e.subscribtions.forEach((function(e){return e()})),e.subscribtionCeremony&&e.subscribtionCeremony!==e.lastCeremony.subscribtionCeremony?Object(i.a)({},tt,{lastCeremony:{subscribtionCeremony:e.subscribtionCeremony,meetups:Object(i.a)({},e.meetups),meetupCount:e.meetupCount,attestations:Object(i.a)({},e.attestations),attestationCount:e.attestationCount,participants:Object(i.a)({},e.participants),participantCount:e.participantCount,subscribtions:null,lastCeremony:null}}):e;default:throw new Error("unknown action ".concat(t.type))}},at=["participants","meetups","attestations"];function rt(e){var t=e.debug,n=Object(a.useRef)(),c=k().api,o=Object(a.useState)({selected:"",loading:!0,menu:!1}),u=Object(p.a)(o,2),m=u[0],f=u[1],d=Object(a.useState)([]),b=Object(p.a)(d,2),y=b[0],E=b[1],h=Object(a.useState)([]),C=Object(p.a)(h,2),v=C[0],g=C[1],O=Object(a.useState)({}),j=Object(p.a)(O,2),S=j[0],I=j[1],w=Object(a.useState)(Ze),N=Object(p.a)(w,2),T=N[0],x=N[1],R=Object(a.useState)({phase:-1,timestamp:0,timer:null}),B=Object(p.a)(R,2),U=B[0],Y=B[1],F=Object(a.useState)(0),K=Object(p.a)(F,2),Z=K[0],H=K[1],J=Object(a.useReducer)(nt,tt),W=Object(p.a)(J,2),$=W[0],X=W[1],ee=c&&c.query&&c.query.encointerCurrencies,te=c&&c.query&&c.query.encointerScheduler;function ne(){return(ne=Object(l.a)(s.a.mark((function e(n,a){var r,c,o,u,l;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e,t,n){return e[a[n]]=t,e},t&&console.log("FETCHING LOCATIONS AND PROPERTIES"),e.t0=Promise,e.next=5,de(ee.locations,n,(function(e){return e.map(Je)}));case 5:return e.t1=e.sent,e.next=8,de(ee.currencyProperties,n);case 8:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=12,e.t0.all.call(e.t0,e.t3);case 12:c=e.sent,o=Object(p.a)(c,2),u=o[0],l=o[1],t&&console.log("SETTING DATA",u,l),I(n.map((function(e,t){return{cid:e,coords:u[t],position:M.latLngBounds(u[t]).getCenter(),demurrage:We(l[t].demurrage_per_block),name:l[t].name_utf8.toString()}})).reduce(r,{})),f(Object(i.a)({},m,{loading:!1}));case 19:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ce(e){return function(){return n.current.leafletElement[e<0?"zoomOut":"zoomIn"]()}}Object(a.useEffect)((function(){var e;if(t&&console.log("phase",U.phase),$e(c,"encointerScheduler")){var n=c.query.encointerScheduler,a=n.currentPhase,r=n.nextPhaseTimestamp;return a((function(e){var t=e.toNumber();U.phase!==t&&r().then((function(e){var n=e.toNumber();Y({phase:t,timestamp:n})})).catch(console.error)})).then((function(t){e=t})),function(){e&&e()}}}),[U.phase,t,ee,c]),Object(a.useEffect)((function(){if($e(c,"encointerScheduler")){var e=c.query.encointerScheduler.currentCeremonyIndex;t&&console.log("ceremony id",U.phase,Z);var n=c.registry.getOrUnknown("CurrencyCeremony"),a=function(){var e=Object(l.a)(s.a.mark((function e(a,r,o){var i,u,l,p,m;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($e(c,"encointerCeremonies")){e.next=2;break}return e.abrupt("return");case 2:if(!(a.toNumber()<=$.subscribtionCeremony&&0===r)){e.next=5;break}return e.abrupt("return");case 5:for(i=c.query.encointerCeremonies,u=i.participantCount,l=i.meetupCount,p=function(e){o.forEach((function(r){var o=new n(c.registry,[r,a]),i=[u,l][e];t&&console.log("hist ",q.encode(r),a.toNumber(),e),i(o).then((function(t){return X({type:at[e],payload:{cid:q.encode(r),count:t.toNumber()}})}))}))},m=0;m<r;m++)p(m);case 8:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),r=function(){var e=Object(l.a)(s.a.mark((function e(t,a){var r,o,i,u,l,m;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($e(c,"encointerCeremonies")){e.next=2;break}return e.abrupt("return");case 2:return r=c.query.encointerCeremonies,o=r.participantCount,i=r.meetupCount,u=t.sub(new G.u32(c.registry,1)),e.next=6,Promise.all(a.map((function(e){var t=new n(c.registry,[e,u]);return c.queryMulti([[o,t],[i,t]])})));case 6:l=e.sent,m=l.reduce((function(e,t,n){var r=q.encode(a[n]),c=Object(p.a)(t,2),o=c[0],i=c[1];return e.meetups[r]=i.toNumber(),e.participants[r]=o.toNumber(),e.participantCount=e.participants[r]+e.participantCount,e.meetupCount=e.meetups[r]+e.meetupCount,e}),{subscribtionCeremony:u.toNumber(),meetups:{},participants:{},participantCount:0,meetupCount:0}),X({type:"last",payload:m});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),o=function(){var e=Object(l.a)(s.a.mark((function e(n,a,r){var o,i,u,l,p,m,f,d;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if($e(c,"encointerCeremonies")){e.next=2;break}return e.abrupt("return");case 2:if(!((o=n.toNumber())<=$.subscribtionCeremony&&a<=$.subscribtionPhase)){e.next=5;break}return e.abrupt("return");case 5:return t&&console.log("subscribe to ceremony",o,a),i=c.query.encointerCeremonies,u=i.participantCount,l=i.attestationCount,p=i.meetupCount,m=[u,p,l],f=c.registry.getOrUnknown("CurrencyCeremony"),e.next=11,Promise.all(r.map((function(e){var t=new f(c.registry,[e,Z]);return(0,m[a])(t,(function(t){return X({type:at[a],payload:{cid:q.encode(e),count:t.toNumber()}})}))})));case 11:d=e.sent,X({type:"subscribe",payload:{subscribtions:d,subscribtionCeremony:o,subscribtionPhase:a}});case 13:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();Z?-1===U.phase||U.phase===$.subscribtionPhase&&Z.toNumber()===$.subscribtionCeremony||!y.length||(o(Z,U.phase,y),a(Z,U.phase,y),!$.lastCeremony.subscribtionCeremony&&r(Z,y)):e().then((function(e){t&&console.log("set ceremonyIndex",e.toString()),H(e)})),U.phase===Xe&&($.subscribtionCeremony!==$.lastCeremony.subscribtionCeremony&&X({type:"reset"}),e().then((function(e){t&&console.log("set ceremonyIndex",e.toString()),H(e)})))}}),[U.phase,Z,y,te,t,c,at]),Object(a.useEffect)((function(){t&&console.log("cids",y),ee&&0===y.length&&ee.currencyIdentifiers().then((function(e){var t=e.map(q.encode);E(e),g(t)})).catch((function(e){return console.error(e)}))}),[y,t,ee]),Object(a.useEffect)((function(){t&&console.log("get locations"),y.length&&y.length===v.length&&function(e,t){ne.apply(this,arguments)}(y,v)}),[y,v]),Object(a.useEffect)((function(){t&&console.log("get position");var e=n.current;null!=e&&T===Ze&&e.leafletElement.locate()}),[n,T]),Object(a.useEffect)((function(){t&&console.log("update resize");var e=n.current&&n.current.leafletElement;e&&setTimeout((function(t){return e.invalidateSize()}),50)}),[m.sidebarSize]);return r.a.createElement(A.a,{as:D.a.Group,className:"encointer-map",fireOnMount:!0,onUpdate:function(e,t){var n=t.width;return f(Object(i.a)({},m,{portrait:n<A.a.onlyMobile.maxWidth,width:n}))}},r.a.createElement(z.a.Pushable,{as:D.a,className:"component-wrapper"},r.a.createElement(V,{visible:m.menu}),r.a.createElement(he,{onClose:function(){n.current.leafletElement.setZoom(m.prevZoom),f(Object(i.a)({},m,{selected:"",sidebarSize:0}))},onShow:function(e){return f(Object(i.a)({},m,{sidebarSize:e,menu:!1}))},hash:m.selected,direction:m.portrait?"bottom":"right",width:"very wide",data:S[m.selected]||{},participantCount:m.selected&&$.participants[m.selected]||0,lastParticipantCount:m.selected?$.lastCeremony.participants[m.selected]:0,meetupCount:m.selected&&$.meetups[m.selected]||0,lastMeetupCount:m.selected?$.lastCeremony.meetups[m.selected]:0,debug:t}),r.a.createElement(z.a.Pusher,{className:"encointer-map-wrapper",style:{marginRight:m.portrait?"0":m.sidebarSize+"px"}},r.a.createElement(Q,{small:m.portrait,participantCount:$.participantCount,meetupCount:$.meetupCount,attestationCount:$.attestationCount,currentPhase:U}),r.a.createElement(ae,{style:m.portrait&&m.selected?{display:"none"}:{}}),r.a.createElement(re,{onClick:function(){return f(Object(i.a)({},m,{menu:!m.menu,selected:m.menu?m.selected:"",sidebarSize:m.menu?m.sidebarSize:0}))},loading:m.loading,onZoomIn:ce(1),onZoomOut:ce(-1)}),r.a.createElement(P.a,{center:T,zoom:4,ref:n,zoomControl:!1,touchZoom:!0,onClick:function(){return m.menu&&f(Object(i.a)({},m,{menu:!1}))},style:{height:function(){if(m.portrait&&m.selected&&m.sidebarSize&&null!==n.current){if("100%"===n.current.container.style.height){var e=n.current.container.offsetHeight-m.sidebarSize;return"".concat(e,"px")}return n.current.container.style.height}return"100%"}()},onLocationFound:function(e){x(e.latlng);var t=n.current.leafletElement;t.flyTo(e.latlng),t.setZoom(8)}},r.a.createElement(_.a,Qe),m.selected?r.a.createElement(Ke,{participantCount:m.selected&&$.participants[m.selected]||0,meetupCount:m.selected&&$.meetups[m.selected]||0,attestationCount:m.selected&&$.attestations[m.selected]||0,phase:U.phase,data:S[m.selected]}):null,m.loading?null:r.a.createElement(Ye,{data:S,cids:v,state:$,onClick:function(e){var t=n.current.leafletElement;f(Object(i.a)({},m,{selected:e,prevZoom:t.getZoom()}));var a=M.latLngBounds(S[e].coords).pad(2);t.fitBounds(a)},selected:m.selected})))),t?r.a.createElement(L,null):null)}n(1320);function ct(){return r.a.createElement(rt,{debug:!0})}o.a.render(r.a.createElement((function(){return r.a.createElement(I,null,r.a.createElement(ct,null))}),null),document.getElementById("root"))},555:function(e){e.exports=JSON.parse('{"APP_NAME":"encointer-explorer","DEVELOPMENT_KEYRING":false,"CUSTOM_TYPES":{"Address":"AccountId","LookupSource":"AccountId","CeremonyPhaseType":{"_enum":["Registering","Assigning","Attesting"]},"CeremonyIndexType":"u32","ParticipantIndexType":"u64","MeetupIndexType":"u64","AttestationIndexType":"u64","CurrencyIdentifier":"Hash","BalanceType":"i128","BalanceEntry":{"principal":"i128","last_update":"BlockNumber"},"CurrencyCeremony":"(CurrencyIdentifier,CeremonyIndexType)","CurrencyPropertiesType":{"name_utf8":"Vec<u8>","demurrage_per_block":"Demurrage"},"Demurrage":"i128","Location":{"lat":"i64","lon":"i64"},"Reputation":{"_enum":["Unverified","UnverifiedReputable","VerifiedUnlinked","VerifiedLinked"]},"ClaimOfAttendance":{"claimant_public":"AccountId","ceremony_index":"CeremonyIndexType","currency_identifier":"CurrencyIdentifier","meetup_index":"MeetupIndexType","location":"Location","timestamp":"Moment","number_of_participants_confirmed":"u32"},"Attestation":{"claim":"ClaimOfAttendance","signature":"Signature","public":"AccountId"},"ProofOfAttendance":{"prover_public":"AccountId","ceremony_index":"CeremonyIndexType","currency_identifier":"CurrencyIdentifier","attendee_public":"AccountId","attendee_signature":"Signature"},"ShardIdentifier":"Hash","Request":{"shard":"ShardIdentifier","cyphertext":"Vec<u8>"},"Enclave":{"pubkey":"AccountId","mrenclave":"Hash","timestamp":"u64","url":"Text"},"Weight":"u32"}}')},577:function(e,t,n){e.exports=n(1321)},607:function(e,t){},654:function(e,t){},656:function(e,t){},665:function(e,t){},667:function(e,t){},694:function(e,t){},695:function(e,t){},764:function(e,t){},795:function(e,t){},844:function(e,t){},968:function(e,t){}},[[577,1,2]]]);
//# sourceMappingURL=main.9add7062.chunk.js.map
(this.webpackJsonpexplorer=this.webpackJsonpexplorer||[]).push([[0],{536:function(e){e.exports=JSON.parse('{"APP_NAME":"encointer-explorer","DEVELOPMENT_KEYRING":false}')},571:function(e,t,n){e.exports=n(837)},591:function(e){e.exports=JSON.parse('{"PROVIDER_SOCKET":"wss://gesell.encointer.org"}')},592:function(e,t){},601:function(e,t){},627:function(e,t){},630:function(e,t){},632:function(e,t){},641:function(e,t){},643:function(e,t){},835:function(e,t,n){},837:function(e,t,n){"use strict";n.r(t);var a=n(1),r=n.n(a),c=n(101),o=n.n(c),i=(n(576),n(20)),u=n.n(i),s=n(21),l=n(33),m=n(2),p=n(869),b=n(876),d=n(375),f=(n(299),n(535)),h=n.n(f),v=n(536),E=n(591),O=["REACT_APP_PROVIDER_SOCKET","REACT_APP_DEVELOPMENT_KEYRING"].reduce((function(e,t){return void 0!==Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})[t]&&(e[t.slice(10)]=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0})[t]),e}),{}),C=Object(s.a)(Object(s.a)(Object(s.a)({},v),E),O),y=h.a.parse(window.location.search).rpc||C.PROVIDER_SOCKET;console.log("Connected socket: ".concat(y));var g={socket:y,keyring:null,keyringState:null,api:null,apiState:null},j=function(e,t){var n=null;switch(t.type){case"RESET_SOCKET":return n=t.payload||e.socket,Object(s.a)(Object(s.a)({},e),{},{socket:n,api:null,apiState:null});case"CONNECT":return Object(s.a)(Object(s.a)({},e),{},{api:t.payload,apiState:"CONNECTING"});case"CONNECT_SUCCESS":return Object(s.a)(Object(s.a)({},e),{},{apiState:"READY"});case"CONNECT_ERROR":return Object(s.a)(Object(s.a)({},e),{},{apiState:"ERROR"});case"SET_KEYRING":return Object(s.a)(Object(s.a)({},e),{},{keyring:t.payload,keyringState:"READY"});case"KEYRING_ERROR":return Object(s.a)(Object(s.a)({},e),{},{keyring:null,keyringState:"ERROR"});default:throw new Error("Unknown type: ".concat(t.type))}},S=r.a.createContext(),w=function(e){var t=Object(s.a)({},g);["socket","types"].forEach((function(n){t[n]="undefined"===typeof e[n]?t[n]:e[n]}));var n=Object(a.useReducer)(j,t),c=Object(m.a)(n,2),o=c[0],i=c[1];return r.a.createElement(S.Provider,{value:[o,i]},e.children)},k=function(){var e=Object(a.useContext)(S),t=Object(m.a)(e,2),n=t[0],r=t[1],c=n.api,o=n.socket,i=n.types,f=Object(a.useCallback)(Object(l.a)(u.a.mark((function e(){var t,n;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=2;break}return e.abrupt("return");case 2:return t=new b.a(o),e.next=5,new p.a(Object(s.a)(Object(s.a)({},Object(d.a)({types:{CurrencyIdentifier:"Hash",CurrencyCeremony:"(CurrencyIdentifier,CeremonyIndexType)",CurrencyPropertiesType:{name_utf8:"Vec<u8>",demurrage_per_block:"Demurrage"}}})),{},{provider:t}));case 5:(n=e.sent).on("connected",(function(){r({type:"CONNECT",payload:n}),n.isReady.then((function(e){return r({type:"CONNECT_SUCCESS"})}))})),n.on("ready",(function(){return r({type:"CONNECT_SUCCESS"})})),n.on("error",(function(){return r({type:"CONNECT_ERROR"})}));case 9:case"end":return e.stop()}}),e)}))),[c,o,i,r]);return Object(a.useEffect)((function(){f()}),[f]),Object(s.a)(Object(s.a)({},n),{},{dispatch:r})},N=n(312),I=n.n(N),x=n(313),T=n.n(x),P=(T()(I.a),n(54)),R=n(530),D=n(532),_=n(882),A=n(879),U=n(873),z=n(30),M=n(208),q=n(878),G=n(272);function B(e){var t=k().api;return window.api=t,window.util=n(6),window.util_crypto=n(63),window.keyring=n(839),null}var L=n(16),F=n(840);n(557);var K=n(877),V=n(129);var H=r.a.memo((function(e){return r.a.createElement(U.a,{as:K.a,animation:"overlay",direction:"left",icon:"labeled",inverted:!0,vertical:!0,visible:e.visible,width:"thin"},r.a.createElement(K.a.Item,{as:"a",href:"//encointer.org",target:"_blank"},r.a.createElement(V.a,{name:"book"}),"Documentation"),r.a.createElement(K.a.Item,{as:"a",href:"//encointer.org/testnet/",target:"_blank"},r.a.createElement(V.a,{name:"block layout"}),"Testnet"),r.a.createElement(K.a.Item,{as:"a",href:"//encointer.org/blog/",target:"_blank"},r.a.createElement(V.a,{name:"newspaper"}),"Blog"),r.a.createElement(K.a.Item,{as:"a",href:"//encointer.org/faq/",target:"_blank"},r.a.createElement(V.a,{name:"question circle"}),"FAQ"),r.a.createElement(K.a.Item,{as:"a",href:"//encointer.org/donate/",target:"_blank"},r.a.createElement(V.a,{name:"dollar"}),"Donate"),r.a.createElement(K.a.Item,{as:"a",href:"//encointer.org/about/",target:"_blank"},r.a.createElement(V.a,{name:"favorite"}),"About"),r.a.createElement(K.a.Item,{as:"a",href:"//github.com/encointer/encointer-node",target:"_blank"},r.a.createElement(V.a,{name:"github"}),"Code"))}),(function(e,t){return e.visible===t.visible})),Y=n(874),W=n(234),Z=function(e){var t=(e-Date.now())/1e3|0;if(t>=0){var n=t%60,a=t/60|0,r=a/60|0,c=r/24|0;r>0&&(a%=60),c>0&&(r%=24);var o=c?c.toString().concat("d "):"",i=r.toString().padStart(2,"0"),u=a.toString().padStart(2,"0"),s=n.toString().padStart(2,"0");return"".concat(o).concat(i,":").concat(u,":").concat(s)}return"finished"};function J(e){var t=e.nextPhaseTimestamp,n=Object(a.useState)(""),c=Object(m.a)(n,2),o=c[0],i=c[1];return Object(a.useEffect)((function(){i(Z(t));var e=setInterval((function(){i(Z(t))}),1e3);return function(){return clearInterval(e)}}),[t]),r.a.createElement(r.a.Fragment,null,o)}var Q=["REGISTERING","ASSIGNING","ATTESTING"],$=function(e){return r.a.createElement("div",null,r.a.createElement("div",null,"starting at:")," ",function(e){return new Date(e).toLocaleString()}(e))},X=r.a.memo((function(e){var t=e.small,n=e.participantCount,a=e.meetupCount,c=e.attestationCount,o=e.currentPhase,i=o.phase,u=o.timestamp,s=[n,a,c];return r.a.createElement("div",{className:"encointer-map-ceremony-phase"},r.a.createElement(Y.a.Group,{ordered:!0,unstackable:!0,className:[Q[i],t?"small-screen":""].join(" "),size:"mini"},function(e){var n=(-1===i?[]:Q).map((function(e,t){return{key:Q[t],counter:s[t],active:t===i,className:"step-".concat(Q[t]).toLowerCase()}})).filter((function(e,n){return!t||e.active||n===i+1||0===n&&2===i}));return t&&2===i?n.reverse():n}().map((function(e,n){return r.a.createElement(Y.a,e,r.a.createElement(Y.a.Content,null,r.a.createElement(Y.a.Title,null,e.key," ",n<=i&&e.counter?r.a.createElement(W.a,{circular:!0,color:e.active?"green":"grey"},e.counter):null),r.a.createElement(Y.a.Description,null,e.active?r.a.createElement("div",null,r.a.createElement("div",null,"time left: "),r.a.createElement(J,{nextPhaseTimestamp:u})):t||n===i+1||0===n&&2===i?$(u):null)))}))))}),(function(e,t){return t.small===e.small&&t.participantCount===e.participantCount&&t.meetupCount===e.meetupCount&&t.attestationCount===e.attestationCount&&t.currentPhase.phase===e.currentPhase.phase&&t.currentPhase.timestamp===e.currentPhase.timestamp})),ee=n(872),te=n(867),ne=r.a.memo((function(e){var t=e.api,n=Object(a.useState)(0),c=Object(m.a)(n,2),o=c[0],i=c[1],u=t&&t.derive&&t.derive.chain&&(e.finalized?t.derive.chain.bestNumberFinalized:t.derive.chain.bestNumber);return Object(a.useEffect)((function(){var e;return u&&u((function(e){i(e.toNumber())})).then((function(t){e=t})).catch(console.error),function(){return e&&e()}}),[u]),r.a.createElement(r.a.Fragment,null,o)}),(function(e){return!0})),ae=r.a.memo((function(e){var t=e.api.query.encointerScheduler.currentCeremonyIndex,n=Object(a.useState)(0),c=Object(m.a)(n,2),o=c[0],i=c[1];return Object(a.useEffect)((function(){var e;return t((function(e){i(e.toNumber())})).then((function(t){e=t})).catch(console.error),function(){return e&&e()}}),[t]),o?r.a.createElement(r.a.Fragment,null,r.a.createElement("span",null,"ceremony")," ",r.a.createElement("strong",null," #",o)):null}),(function(e){return!0}));function re(e){var t=e.apiState,n=e.api,c=e.onClickNode,o=Object(a.useState)({}),i=Object(m.a)(o,2),s=i[0],p=i[1],b=n&&n.rpc&&n.rpc.system,d=n&&n.query&&n.query.encointerScheduler&&n.query.encointerScheduler.currentCeremonyIndex;return Object(a.useEffect)((function(){b&&function(){var e=Object(l.a)(u.a.mark((function e(){var t,n,a,r,c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Promise.all([b.chain(),b.name(),b.version()]);case 3:t=e.sent,n=Object(m.a)(t,3),a=n[0],r=n[1],c=n[2],p({chain:a,nodeName:r,nodeVersion:c}),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),console.error(e.t0);case 14:case"end":return e.stop()}}),e,null,[[0,11]])})));return function(){return e.apply(this,arguments)}}()()}),[b]),r.a.createElement(ee.a,{className:"encointer-map-node-info",style:e.style||{}},"READY"===t?r.a.createElement(r.a.Fragment,null,r.a.createElement(ee.a.Content,{className:"info",onClick:c},r.a.createElement(ee.a.Header,null,s.nodeName," ",r.a.createElement(V.a,{name:"chevron down"})),r.a.createElement(ee.a.Meta,null,"".concat(s.chain||""," v").concat(s.nodeVersion))),r.a.createElement(ee.a.Content,{className:"blocks"},d?r.a.createElement(r.a.Fragment,null,r.a.createElement(ee.a.Meta,null),r.a.createElement("div",{className:"block-current"},"current block #",r.a.createElement(ne,{api:n})),r.a.createElement("div",{className:"finalized-current"},"finalized block #",r.a.createElement(ne,{finalized:!0,api:n})),r.a.createElement("div",{className:"ceremony"},r.a.createElement(ae,{api:n}))):r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"loading"},r.a.createElement(te.a,{active:!0,size:"medium",inline:"centered"}))))):r.a.createElement(ee.a.Content,{className:"loading"},"ERROR"!==t?r.a.createElement(ee.a.Meta,null,r.a.createElement(te.a,{active:!0,size:"small",inline:!0})," Connecting to the blockchain"):r.a.createElement(ee.a.Meta,{className:"error"},"Error connecting to the blockchain")))}function ce(e){return r.a.createElement(re,e)}var oe=r.a.memo((function(e){var t=e.loading,n=e.onZoomIn,a=e.onZoomOut,c=e.onClick;return r.a.createElement(K.a,{className:"encointer-map-floating-widgets",stackable:!0,size:"mini",vertical:!0},r.a.createElement(K.a.Item,null,r.a.createElement(F.a,{onClick:c,loading:t,disabled:t,icon:"sidebar",className:"encoiner-menu-button"})),r.a.createElement(K.a.Item,null,r.a.createElement(F.a.Group,{vertical:!0,compact:!0,size:"small"},r.a.createElement(F.a,{icon:"plus",onClick:n}),r.a.createElement(F.a,{icon:"minus",onClick:a}))))}),(function(e,t){return e.loading===t.loading})),ie=n(880),ue=n(875),se=n(871),le=n(235),me=n.n(le);function pe(e,t){var n=e+t;return me()(n>=8,"Bit length can't be less than 8, provided ".concat(n)),me()(n<=128,"Bit length can't be bigger than 128, provided ".concat(n)),me()(!(n&n-1),"Bit length should be power of 2, provided ".concat(n)),function(e){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:t;me()(e.bitLength()===n,"Bit length is not equal to "+n);var r=e.toString(2,n),c=(t>r.length?r.padStart(t,"0"):r).slice(-t,-1*(t-a)||void 0),o=c.split("").reduce((function(e,t,n){return e+="1"===t?1/Math.pow(2,n+1):0}),0),i=r.slice(0,-t),u=i?parseInt(i,2):0;return u+(e.negative?-o:o)}}pe(4,4),pe(8,8),pe(16,16),pe(32,32);var be=pe(64,64);function de(e,t,n){var a=e;return t&&(a=a.map(t)),n&&(a=a.reduce(n,{})),a}function fe(e,t,n,a){return he.apply(this,arguments)}function he(){return(he=Object(l.a)(u.a.mark((function e(t,n,a,r){var c;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(n.map((function(e){return t(e)})));case 2:return c=e.sent,e.abrupt("return",de(c,a,r));case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ve=T()(I.a);function Ee(e){var t=e.api,n=e.debug,c=e.onClose,o=e.onShow,i=e.hash,u=e.direction,s=e.width,l=e.participantCount,p=e.lastParticipantCount,b=e.lastMeetupCount,d=e.meetupCount,f=e.data,h=f.name,v=f.cid,E=f.demurrage,O=f.demurragePerBlock,C=!!i.length,y=Object(a.useRef)(),g="top"===u||"bottom"===u,j=Object(a.useState)([]),S=Object(m.a)(j,2),w=S[0],k=S[1],N=Object(a.useState)(null),I=Object(m.a)(N,2),x=I[0],T=I[1],P=Object(a.useState)(1),R=Object(m.a)(P,2),D=R[0],_=R[1],z=Object(a.useState)(0),M=Object(m.a)(z,2),q=M[0],G=M[1];Object(a.useEffect)((function(){var e;return(0,t.derive.chain.bestNumber)((function(e){_(e.toNumber())})).then((function(t){console.log("U",t),e=t})),function(){return e&&e()}}),[t.derive.chain.bestNumber]),Object(a.useEffect)((function(){var e;if(v&&t.query.encointerCommunities)return n&&console.log("GETTING BOOTSTRAPPERS",v),t.query.encointerCommunities.bootstrappers(v,(function(e){n&&console.log("BOOTSTRAPPERS RECEIVED",e),k(e.toJSON())})).then((function(t){e=t})).catch(console.error),function(){return e&&e()}}),[t.query.encointerCommunities,v,n]),Object(a.useEffect)((function(){var e;if(v&&t.query.encointerBalances)return n&&console.log("GETTING MONEYSUPPLY",v),t.query.encointerBalances.totalIssuance(v,(function(e){n&&console.log("MONEYSUPPLY RECEIVED",e),T({principal:be(e.get("principal")),lastUpdate:e.get("last_update").toNumber()})})).then((function(t){e=t})).catch(console.error),function(){return e&&e()}}),[t.query.encointerBalances,v,n]);var B=Object(a.useCallback)((function(){var e=x&&x.principal>0?x.principal*Math.exp(-O*(D-x.lastUpdate)):0;G(e)}),[O,D,x]);Object(a.useEffect)((function(){B()}),[B]);return r.a.createElement(U.a,{className:"details-sidebar",ref:y,as:A.a.Group,animation:"overlay",icon:"labeled",direction:u,visible:C,width:s,onShow:function(){return y.current&&o(y.current.ref.current["offset".concat(g?"Height":"Width")])}},r.a.createElement(A.a,{padded:!0},r.a.createElement(ie.a,null,r.a.createElement(V.a,{name:"money bill alternate"}),r.a.createElement(ie.a.Content,null,"Currency info"))),r.a.createElement(A.a,{textAlign:"center"},r.a.createElement(ie.a,{sub:!0,textAlign:"left"},"Currency ID:"),r.a.createElement(ue.a,{size:"small",color:"blue"},i),r.a.createElement("p",null,h)),r.a.createElement(A.a.Group,null,r.a.createElement(A.a.Group,{horizontal:!0},r.a.createElement(A.a,null,r.a.createElement(ie.a,{sub:!0},"Demurrage rate (per month):"),E&&E.toFixed(2),"%",r.a.createElement(ie.a,{sub:!0},"participants registered:"),l,r.a.createElement(ie.a,{sub:!0},"participants registered in last ceremony:"),p),r.a.createElement(A.a,null,r.a.createElement(ie.a,{sub:!0},"Money supply:"),r.a.createElement("p",null,!isNaN(q)&&new ve(q).toFormat(2)),r.a.createElement(ie.a,{sub:!0},"meetups assigned:"),d,r.a.createElement(ie.a,{sub:!0},"meetups assigned in last ceremony:"),b)),r.a.createElement(A.a,{loading:!w.length,stacked:!0},r.a.createElement(ie.a,{sub:!0},"List of bootstrappers:"),r.a.createElement(se.a,null,w.map((function(e){return r.a.createElement(se.a.Item,{key:e},e)}))))),r.a.createElement(A.a,{textAlign:"right",className:"map-sidebar-close"},r.a.createElement(F.a,{content:"Close",icon:"angle "+(g?"down":"right"),labelPosition:"right",onClick:c})))}var Oe=r.a.memo((function(e){var t=e.api;return t&&t.query?r.a.createElement(Ee,e):null}),(function(e,t){return e.hash===t.hash&&(!t.hash||e.participantCount===t.participantCount&&e.lastParticipantCount===t.lastParticipantCount&&e.meetupCount===t.meetupCount&&e.lastMeetupCount===t.lastMeetupCount)})),Ce=n(881),ye=n(868);function ge(){try{var e=localStorage.getItem("encointer-explorer-custom-endpoints");if(e)return JSON.parse(e)}catch(t){console.error(t)}return[]}function je(){return[{isHeader:!0,text:"Test networks",value:""},{info:"encointer",text:"Gesell",icon:"encointer-notee.svg",provider:"Encointer Association",value:"wss://gesell.encointer.org"},{info:"encointer",text:"Cantillon",icon:"encointer-teeproxy.svg",provider:"Encointer Association",value:"wss://cantillon.encointer.org"},{isDevelopment:!0,isHeader:!0,text:"Development",value:""},{info:"local",text:"Local Node (Own, 127.0.0.1:9944)",value:"ws://127.0.0.1:9944"}].concat(Object(L.a)(ge().map((function(e){return{info:"local",text:"Custom: ".concat(e),value:e}})))).filter((function(e){return!e.isDisabled}))}function Se(e){return e.reduce((function(e,t){if(t.isHeader)e.push({header:t.text,isDevelopment:t.isDevelopment,networks:[]});else{var n=t.text,a=e[e.length-1],r={name:t.provider?"hosted by "+t.provider:t.value,url:t.value};a.networks[a.networks.length-1]&&n===a.networks[a.networks.length-1].name?a.networks[a.networks.length-1].providers.push(r):a.networks.push({icon:t.icon,isChild:t.isChild,name:n,providers:[r]})}return e}),[])}function we(e){var t=e.apiUrl,n=e.className,c=e.label,o=e.setApiUrl,i=e.url,u=Object(a.useCallback)((function(){return o(i)}),[o,i]);return r.a.createElement(Ce.a,{className:n,label:c,onChange:u,checked:t===i})}function ke(e){var t=e.apiUrl,n=e.className,c=void 0===n?"":n,o=e.setApiUrl,i=e.value,u=i.icon,s=i.isChild,l=i.name,m=i.providers,p=Object(a.useMemo)((function(){return m.some((function(e){return e.url===t}))}),[t,m]),b=Object(a.useCallback)((function(){return o(m[0].url)}),[m,o]);return r.a.createElement("div",{className:"endpoint-network ".concat(c).concat(p?" isSelected highlight--border":"")},r.a.createElement("div",{className:"endpoint-section".concat(s?" isChild":""),onClick:b},u?r.a.createElement("img",{className:"endpoint-icon",alt:"chain logo",src:"/".concat(u)}):null,r.a.createElement("div",{className:"endpoint-value"},l)),p&&m.map((function(e){var n=e.name,a=e.url;return r.a.createElement(we,{apiUrl:t,key:a,label:n,setApiUrl:o,url:a,className:"endpoint-address"})})))}function Ne(e){var t=e.apiUrl,n=e.children,c=e.className,o=void 0===c?"":c,i=e.index,u=e.isSelected,s=e.setApiUrl,l=e.setGroup,m=e.value,p=m.header,b=m.networks,d=Object(a.useCallback)((function(){return l(u?-1:i)}),[i,u,l]);return r.a.createElement(A.a,{padded:!0,className:"".concat(o).concat(u?" isSelected":"")},r.a.createElement("div",{className:"groupHeader",onClick:d},r.a.createElement(V.a,{name:u?"chevron up":"chevron down"}),p),u&&r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"group-networks"},b.map((function(e,n){return r.a.createElement(ke,{apiUrl:t,key:n,setApiUrl:s,value:e})}))),n))}function Ie(e){var t=e.socket,n=e.onClose,c=e.visible,o=je(),i=Object(a.useState)(Se(o)),u=Object(m.a)(i,2),l=u[0],p=u[1],b=Object(a.useCallback)((function(e,n){var a,r=n.findIndex((function(t){return t.networks.some((function(t){return t.providers.some((function(t){return t.url===e}))}))}));return-1===r&&(r=n.findIndex((function(e){return e.isDevelopment}))),{apiUrl:e,groupIndex:r,hasUrlChanged:t!==e,isUrlValid:(a=e,a.length>=7&&(a.startsWith("ws://")||a.startsWith("wss://")))}}),[t]),d=Object(a.useState)(b(t,l)),f=Object(m.a)(d,2),h=f[0],v=h.apiUrl,E=h.groupIndex,O=h.hasUrlChanged,C=h.isUrlValid,y=f[1],g=Object(a.useState)(ge()),j=Object(m.a)(g,2),S=j[0],w=j[1],k=(Object(a.useMemo)((function(){var e=!1;return o.some((function(t){return t.value===v&&(e=!0,!0)})),e}),[v,o]),Object(a.useMemo)((function(){var e=!1;return S.some((function(t){return t===v&&(e=!0,!0)})),e}),[v,S])),N=Object(a.useCallback)((function(e){return y((function(t){return Object(s.a)(Object(s.a)({},t),{},{groupIndex:e})}))}),[]),I=function(){if(k){var e=S.filter((function(e){return e!==v}));try{localStorage.setItem("encointer-explorer-custom-endpoints",JSON.stringify(e)),p(Se(je())),w(ge())}catch(t){console.error(t)}}},x=Object(a.useCallback)((function(e){return y(b(e,l))}),[b,l]),T=Object(a.useCallback)((function(e){var t=e.target.value;y(b(t,l))}),[b,l]),P=Object(a.useCallback)((function(){window.location.assign("".concat(window.location.origin).concat(window.location.pathname,"?rpc=").concat(encodeURIComponent(v)).concat(window.location.hash)),n()}),[v,n]),R=function(){try{localStorage.setItem("encointer-explorer-custom-endpoints",JSON.stringify([].concat(Object(L.a)(S),[v]))),P()}catch(e){console.error(e)}};return r.a.createElement(U.a,{visible:c,as:A.a.Group,className:"node-switch-widget",onClose:n,position:"left",vertical:"true",width:"wide",animation:"overlay"},l.map((function(e,t){return r.a.createElement(Ne,{apiUrl:v,index:t,isSelected:E===t,key:t,setApiUrl:x,setGroup:N,value:e},e.isDevelopment&&r.a.createElement("div",{className:"endpointCustomWrapper"},r.a.createElement("div",null,"Custom endpoint"),r.a.createElement(ye.a,{className:"endpointCustom",error:!C,onChange:T,value:v,action:k?r.a.createElement(F.a,{onClick:I}," ",r.a.createElement(V.a,{name:"trash alternate"})):r.a.createElement(F.a,{onClick:R}," ",r.a.createElement(V.a,{name:"save"}))})))})),r.a.createElement(A.a,{className:"node-switch-confirm"},r.a.createElement(F.a,{icon:"sync",disabled:!(O&&C),positive:!0,content:"Switch",onClick:P,fluid:!0})),r.a.createElement(A.a,{textAlign:"left",className:"node-switch-close"},r.a.createElement(F.a,{content:"Close",labelPosition:"left",icon:"angle left",onClick:n})))}var xe=n(531),Te=n(533),Pe=n(323),Re=n.n(Pe),De=z.divIcon,_e="marker-cluster marker-cluster-small ".concat("encoiner-community-icon"),Ae="marker-cluster marker-cluster-small ".concat("encoiner-cluster-custom"),Ue=[40,40],ze=function(e,t){return new De({iconSize:Ue,className:"".concat(e),html:"<div><span>".concat(t,"</span></div>")})},Me=function(e){return ze(_e.concat(" ",e),"$")},qe=function(e,t){return ze(Ae.concat(" ",e),t)},Ge=Me(""),Be=Me("pulse"),Le=Me("yellow pulse"),Fe=Me("yellow"),Ke=Me("red"),Ve=new z.Icon({iconUrl:"https://cdn.rawgit.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]}),He=function(e,t,n){var a;return a=0===e?t?"green":"yellow":0!==t?t>1?"green":"yellow":"red",n?a.concat(" pulse"):a},Ye=[40,40],We={"green pulse":Be,"yellow pulse":Le,"red pulse":Le,green:Ge,yellow:Fe,red:Ke},Ze=function(e,t,n){var a=He(e,t,n);return We[a]},Je=function(e){var t=e.getAllChildMarkers(),n=t[0].options.phase,a=t.map((function(e){return e.options.count})).reduce((function(e,t){return t>e?t:e}),0),r=t.map((function(e){return e.options.active})).reduce((function(e,t){return t||e}),!1),c=He(n,a,r),o=e.getChildCount();return qe(c,o)},Qe={timers:{},byCID:{},phase:-1},$e=function(e,t){switch(t.type){case"initialize":return function(e,t){var n=t.payload,a=n.phase,r=n.byCID;return Object(s.a)(Object(s.a)({},e),{},{byCID:r,phase:a})}(e,t);case"phase":return Object(s.a)(Object(s.a)({},e),{},{phase:t.payload});case"reset":return function(e,t){var n=t.payload,a=n.phase,r=n.byCID,c=Object(s.a)({},e.byCID);for(var o in c)c[o].count=r[o]||0;return Object(s.a)(Object(s.a)({},e),{},{byCID:c,phase:a})}(e,t);case"activate":return function(e,t){var n=t.payload,a=n.timers,r=Object(s.a)(Object(s.a)({},e.byCID),n.byCID);for(var c in a)e.timers[c]&&clearTimeout(e.timers[c]);return Object(s.a)(Object(s.a)({},e),{},{byCID:r,timers:Object(s.a)(Object(s.a)({},e.timers),a)})}(e,t);case"deactivate":return function(e,t){var n=t.payload,a=Object(s.a)({},e.byCID),r=Object(s.a)({},e.timers);return a[n]=Object(s.a)(Object(s.a)({},a[n]),{},{active:!1}),clearTimeout(r[n]),r[n]=0,Object(s.a)(Object(s.a)({},e),{},{byCID:a,timers:r})}(e,t);default:return e}};function Xe(e){var t=e.cids,n=e.data,c=e.selected,o=e.state,i=Object(a.useReducer)($e,Qe),u=Object(m.a)(i,2),s=u[0],l=u[1],p=Object(a.useRef)(null),b=o.subscribtionPhase,d=o[["participants","meetups","meetups"][b]],f=o.attestations,h=s.byCID;if(-1===s.phase&&-1!==b){var v=t.map((function(e){var t=n[e],a=t.position,r=t.name,c=o.meetups[e]||0;return{name:r,key:e,position:a,active:!1,count:b?c:d[e]||0,attests:2===b&&f[e]||0}})).reduce((function(e,t){return e[t.key]=t,e}),{});l({type:"initialize",payload:{byCID:v,phase:b}})}else(b>s.phase||0===b&&2===s.phase)&&l({type:"reset",payload:{byCID:d,phase:b}});return Object(a.useEffect)((function(){var e={},n={};t.forEach((function(t){var a=d&&d[t]||0,r=f?f[t]:0;s.byCID[t]&&(s.byCID[t].count<a||s.byCID[t].attests<r)&&(e[t]=s.byCID[t],e[t].count=a,e[t].attests=f[t]||0,e[t].active=!0,n[t]=setTimeout((function(){l({type:"deactivate",payload:t})}),3e3))})),l({type:"activate",payload:{byCID:e,timers:n}})}),[d,f,t]),Object(a.useEffect)((function(){var e,t=[];for(var n in s.byCID)s.byCID[n].active&&t.push(n);return t.length&&(e=setTimeout((function(){null!==p.current&&p.current.leafletElement&&p.current.leafletElement.refreshClusters()}),10)),function(){e&&clearTimeout(e)}}),[h]),r.a.createElement(Re.a,{ref:p,onClick:function(t){return t.sourceTarget.options.alt&&e.onClick(t.sourceTarget.options.alt)},iconCreateFunction:Je,chunkedLoading:!0},t.map((function(e){var t=n[e],a=t.position,o=t.name,i=h[e]||{},u=i.active,l=i.count,m=i.attests;return c===e?null:r.a.createElement(xe.a,{key:e.concat(b,m,l,u?"force-redraw":""),position:a,alt:e,count:l,active:u,phase:b,attests:m,icon:Ze(s.phase,l,u)},r.a.createElement(Te.a,{direction:"top",offset:[0,Ye[1]/-2]},o))})))}var et=function(e){var t=e.getAllChildMarkers(),n=t[0].options.phase,a=t[0].options.count,r=t[0].options.active,c=t.length;return qe(He(n,a,r),c)},tt=function(e,t){switch(t.type){case"reset":return{active:!1,count:0,attest:0,timeout:e.timeout};case"activate":return function(e,t){var n=t.payload,a=n.count,r=n.timeout,c=n.attest;return Object(s.a)(Object(s.a)({},e),{},{active:!0,count:a,attest:c,timeout:r})}(e,t);case"deactivate":return function(e,t){return clearTimeout(e.timeout),Object(s.a)(Object(s.a)({},e),{},{active:!1})}(e);default:return e}};function nt(e){var t=e.phase,n=e.meetupCount,c=e.participantCount,o=e.attestationCount,i=e.data.coords,u=Object(a.useRef)(null),s=0===t?c:n,l=Object(a.useReducer)(tt,{active:!1,count:s,attest:o}),p=Object(m.a)(l,2),b=p[0],d=p[1],f=b.active;return Object(a.useEffect)((function(){if(0===s&&0===t&&(b.attest>0||b.count>0))d({type:"reset"});else if(b.count<s||b.attest<o){var e=setTimeout((function(){d({type:"deactivate"})}),3e3);d({type:"activate",payload:{count:s,timeout:e,attest:o}})}}),[b,s,o,t]),Object(a.useEffect)((function(){var e;return f&&(e=setTimeout((function(){null!==u.current&&u.current.leafletElement&&u.current.leafletElement.refreshClusters()}),10)),function(){e&&clearTimeout(e)}}),[f]),i&&i.length?r.a.createElement(Re.a,{ref:u,iconCreateFunction:et},i.map((function(e,n){return r.a.createElement(xe.a,{position:e,key:"".concat(n,s,o,f?"force-redraw":""),phase:t,count:s,attest:b.attest,active:f,icon:Ve})}))):null}n(833),n(834);var at=z.latLng(47.166168,8.515495),rt=function(e){return be(e,16)},ct=function(e){return[rt(e.lat),rt(e.lon)]},ot=function(e){return 100*(1-Math.exp(-1*be(e)*438e3))},it={url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:'&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>'},ut=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=e&&e.queryMulti&&e.query;return n&&t?!!n[t]:!!n},st=0,lt=function(e){return Object.keys(e).reduce((function(t,n){return t+=e[n]}),0)},mt={subscribtionCeremony:0,subscribtionPhase:-1,lastCeremony:{participants:{},meetups:{},attestations:{}},subscribtions:[],participantCount:0,meetupCount:0,attestationCount:0,participants:{},meetups:{},attestations:{}},pt=function(e,t){switch(t.type){case"unsubscribeAll":return e.subscribtions.forEach((function(e){return e()})),Object(s.a)(Object(s.a)({},e),{},{subscribtions:[]});case"subscribe":return e.subscribtions.forEach((function(e){return e()})),Object(s.a)(Object(s.a)({},e),t.payload);case"participants":return function(e,t){var n=Object(s.a)(Object(s.a)({},e.participants),{},Object(P.a)({},t.payload.cid,t.payload.count)),a=lt(n);return Object(s.a)(Object(s.a)({},e),{},{participants:n,participantCount:a})}(e,t);case"meetups":return function(e,t){var n=Object(s.a)(Object(s.a)({},e.meetups),{},Object(P.a)({},t.payload.cid,t.payload.count)),a=lt(n);return Object(s.a)(Object(s.a)({},e),{},{meetups:n,meetupCount:a})}(e,t);case"attestations":return function(e,t){var n=Object(s.a)(Object(s.a)({},e.attestations),{},Object(P.a)({},t.payload.cid,t.payload.count)),a=lt(n);return Object(s.a)(Object(s.a)({},e),{},{attestations:n,attestationCount:a})}(e,t);case"last":return Object(s.a)(Object(s.a)({},e),{},{lastCeremony:t.payload});case"reset":return e.subscribtions.forEach((function(e){return e()})),e.subscribtionCeremony&&e.subscribtionCeremony!==e.lastCeremony.subscribtionCeremony?Object(s.a)(Object(s.a)({},mt),{},{lastCeremony:{subscribtionCeremony:e.subscribtionCeremony,meetups:Object(s.a)({},e.meetups),meetupCount:e.meetupCount,attestations:Object(s.a)({},e.attestations),attestationCount:e.attestationCount,participants:Object(s.a)({},e.participants),participantCount:e.participantCount,subscribtions:null,lastCeremony:null}}):e;default:throw new Error("unknown action ".concat(t.type))}},bt=["participants","meetups","attestations"];function dt(e){var t=e.debug,n=Object(a.useRef)(),c=k(),o=c.api,i=c.apiState,p=c.socket,b=Object(a.useState)({selected:"",loading:!0,menu:!1,nodeSwitch:!1}),d=Object(m.a)(b,2),f=d[0],h=d[1],v=Object(a.useState)([]),E=Object(m.a)(v,2),O=E[0],C=E[1],y=Object(a.useState)([]),g=Object(m.a)(y,2),j=g[0],S=g[1],w=Object(a.useState)({}),N=Object(m.a)(w,2),I=N[0],x=N[1],T=Object(a.useState)(at),P=Object(m.a)(T,2),L=P[0],F=P[1],K=Object(a.useState)({phase:-1,timestamp:0,timer:null}),V=Object(m.a)(K,2),Y=V[0],W=V[1],Z=Object(a.useState)(0),J=Object(m.a)(Z,2),Q=J[0],$=J[1],ee=Object(a.useReducer)(pt,mt),te=Object(m.a)(ee,2),ne=te[0],ae=te[1],re=o&&o.query&&(o.query.encointerCommunities||o.query.encointerCurrencies);o&&o.query&&o.query.encointerScheduler;function ie(){return(ie=Object(l.a)(u.a.mark((function e(n,a){var r,c,o,i,l,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=function(e,t,n){return e[a[n]]=t,e},t&&console.log("FETCHING LOCATIONS AND PROPERTIES"),c=re.communityMetadata||re.currencyProperties,e.t0=Promise,e.next=6,fe(re.locations,n,(function(e){return e.map(ct)}));case 6:return e.t1=e.sent,e.next=9,fe(c,n);case 9:return e.t2=e.sent,e.t3=[e.t1,e.t2],e.next=13,e.t0.all.call(e.t0,e.t3);case 13:o=e.sent,i=Object(m.a)(o,2),l=i[0],p=i[1],t&&console.log("SETTING DATA",l,p),x(n.map((function(e,t){return{cid:e,coords:l[t],position:z.latLngBounds(l[t]).getCenter(),demurrage:p[t].demurrage_per_block?ot(p[t].demurrage_per_block):1,demurragePerBlock:p[t].demurrage_per_block?be(p[t].demurrage_per_block):0,name:p[t].name_utf8?Object(G.a)(p[t].name_utf8):p[t].name}})).reduce(r,{})),h(Object(s.a)(Object(s.a)({},f),{},{loading:!1}));case 20:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ue(e){return function(){return n.current.leafletElement[e<0?"zoomOut":"zoomIn"]()}}Object(a.useEffect)((function(){var e;if(t&&console.log("phase",Y.phase),ut(o,"encointerScheduler")){var n=o.query.encointerScheduler,a=n.currentPhase,r=n.nextPhaseTimestamp;return a((function(e){var t=e.toNumber();Y.phase!==t&&r().then((function(e){var n=e.toNumber();W({phase:t,timestamp:n})})).catch(console.error)})).then((function(t){e=t})),function(){e&&e()}}}),[Y.phase,t,re,o]),Object(a.useEffect)((function(){if(ut(o,"encointerScheduler")){var e=o.query.encointerScheduler.currentCeremonyIndex;t&&console.log("ceremony id",Y.phase,Q);var n=o.registry.getOrUnknown("CommunityCeremony"),a=function(){var e=Object(l.a)(u.a.mark((function e(a,r,c){var i,s,l,m,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut(o,"encointerCeremonies")){e.next=2;break}return e.abrupt("return");case 2:if(!(a.toNumber()<=ne.subscribtionCeremony&&0===r)){e.next=5;break}return e.abrupt("return");case 5:for(i=o.query.encointerCeremonies,s=i.participantCount,l=i.meetupCount,m=function(e){c.forEach((function(r){var c=new n(o.registry,[r,a]),i=[s,l][e];t&&console.log("hist ",M.encode(r),a.toNumber(),e),i(c).then((function(t){return ae({type:bt[e],payload:{cid:M.encode(r),count:t.toNumber()}})}))}))},p=0;p<r;p++)m(p);case 8:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}(),r=function(){var e=Object(l.a)(u.a.mark((function e(t,a){var r,c,i,s,l,p;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut(o,"encointerCeremonies")){e.next=2;break}return e.abrupt("return");case 2:return r=o.query.encointerCeremonies,c=r.participantCount,i=r.meetupCount,s=t.sub(new q.a(o.registry,1)),e.next=6,Promise.all(a.map((function(e){var t=new n(o.registry,[e,s]);return o.queryMulti([[c,t],[i,t]])})));case 6:l=e.sent,p=l.reduce((function(e,t,n){var r=M.encode(a[n]),c=Object(m.a)(t,2),o=c[0],i=c[1];return e.meetups[r]=i.toNumber(),e.participants[r]=o.toNumber(),e.participantCount=e.participants[r]+e.participantCount,e.meetupCount=e.meetups[r]+e.meetupCount,e}),{subscribtionCeremony:s.toNumber(),meetups:{},participants:{},participantCount:0,meetupCount:0}),ae({type:"last",payload:p});case 9:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),c=function(){var e=Object(l.a)(u.a.mark((function e(n,a,r){var c,i,s,l,m,p,b,d;return u.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ut(o,"encointerCeremonies")){e.next=2;break}return e.abrupt("return");case 2:if(!((c=n.toNumber())<=ne.subscribtionCeremony&&a<=ne.subscribtionPhase)){e.next=5;break}return e.abrupt("return");case 5:return t&&console.log("subscribe to ceremony",c,a),i=o.query.encointerCeremonies,s=i.participantCount,l=i.attestationCount,m=i.meetupCount,p=[s,m,l],b=o.registry.getOrUnknown("CommunityCeremony"),e.next=11,Promise.all(r.map((function(e){var t=new b(o.registry,[e,Q]);return(0,p[a])(t,(function(t){return ae({type:bt[a],payload:{cid:M.encode(e),count:t.toNumber()}})}))})));case 11:d=e.sent,ae({type:"subscribe",payload:{subscribtions:d,subscribtionCeremony:c,subscribtionPhase:a}});case 13:case"end":return e.stop()}}),e)})));return function(t,n,a){return e.apply(this,arguments)}}();Q?-1===Y.phase||Y.phase===ne.subscribtionPhase&&Q.toNumber()===ne.subscribtionCeremony||!O.length||(c(Q,Y.phase,O),a(Q,Y.phase,O),!ne.lastCeremony.subscribtionCeremony&&r(Q,O)):e().then((function(e){t&&console.log("set ceremonyIndex",e.toString()),$(e)})),Y.phase===st&&(ne.subscribtionCeremony!==ne.lastCeremony.subscribtionCeremony&&ae({type:"reset"}),e().then((function(e){t&&console.log("set ceremonyIndex",e.toString()),$(e)})))}}),[Y.phase,Q]),Object(a.useEffect)((function(){(t&&console.log("cids",O),re&&0===O.length)&&(re.communityIdentifiers||re.currencyIdentifiers)().then((function(e){var t=e.map(M.encode);C(e),S(t)})).catch((function(e){return console.error(e)}))}),[O,t,re]),Object(a.useEffect)((function(){t&&console.log("get locations"),O.length&&O.length===j.length&&function(e,t){ie.apply(this,arguments)}(O,j)}),[O,j]),Object(a.useEffect)((function(){t&&console.log("get position");var e=n.current;null!=e&&L===at&&e.leafletElement.locate()}),[n,L]),Object(a.useEffect)((function(){t&&console.log("update resize");var e=n.current&&n.current.leafletElement;e&&setTimeout((function(t){return e.invalidateSize()}),50)}),[f.sidebarSize]);return r.a.createElement(_.a,{as:A.a.Group,className:"encointer-map",fireOnMount:!0,onUpdate:function(e,t){var n=t.width;return h(Object(s.a)(Object(s.a)({},f),{},{portrait:n<_.a.onlyMobile.maxWidth,width:n}))}},r.a.createElement(U.a.Pushable,{as:A.a,className:"component-wrapper"},r.a.createElement(H,{visible:f.menu}),r.a.createElement(Ie,{socket:p,visible:f.nodeSwitch,onClose:function(){return h(Object(s.a)(Object(s.a)({},f),{},{nodeSwitch:!1}))}}),r.a.createElement(Oe,{api:o,apiState:i,onClose:function(){n.current.leafletElement.setZoom(f.prevZoom),h(Object(s.a)(Object(s.a)({},f),{},{selected:"",sidebarSize:0}))},onShow:function(e){return h(Object(s.a)(Object(s.a)({},f),{},{sidebarSize:e,menu:!1,nodeSwitch:!1}))},hash:f.selected,direction:f.portrait?"bottom":"right",width:"very wide",data:I[f.selected]||{},participantCount:f.selected&&ne.participants[f.selected]||0,lastParticipantCount:f.selected?ne.lastCeremony.participants[f.selected]:0,meetupCount:f.selected&&ne.meetups[f.selected]||0,lastMeetupCount:f.selected?ne.lastCeremony.meetups[f.selected]:0,debug:t}),r.a.createElement(U.a.Pusher,{className:"encointer-map-wrapper",style:{marginRight:f.portrait?"0":f.sidebarSize+"px"}},r.a.createElement(X,{small:f.portrait,participantCount:ne.participantCount,meetupCount:ne.meetupCount,attestationCount:ne.attestationCount,currentPhase:Y}),r.a.createElement(ce,{api:o,apiState:i,onClickNode:function(){return!f.nodeSwitch&&h(Object(s.a)(Object(s.a)({},f),{},{nodeSwitch:!0}))},style:f.portrait&&f.selected?{display:"none"}:{}}),r.a.createElement(oe,{onClick:function(){return h(Object(s.a)(Object(s.a)({},f),{},{menu:!f.menu,selected:f.menu?f.selected:"",sidebarSize:f.menu?f.sidebarSize:0}))},loading:f.loading,onZoomIn:ue(1),onZoomOut:ue(-1)}),r.a.createElement(R.a,{center:L,zoom:4,ref:n,zoomControl:!1,touchZoom:!0,onClick:function(){return f.menu&&h(Object(s.a)(Object(s.a)({},f),{},{menu:!1,nodeSwitch:!1}))},style:{height:function(){if(f.portrait&&f.selected&&f.sidebarSize&&null!==n.current){if("100%"===n.current.container.style.height){var e=n.current.container.offsetHeight-f.sidebarSize;return"".concat(e,"px")}return n.current.container.style.height}return"100%"}()},onLocationFound:function(e){F(e.latlng);var t=n.current.leafletElement;t.flyTo(e.latlng),t.setZoom(8)}},r.a.createElement(D.a,it),f.selected?r.a.createElement(nt,{participantCount:f.selected&&ne.participants[f.selected]||0,meetupCount:f.selected&&ne.meetups[f.selected]||0,attestationCount:f.selected&&ne.attestations[f.selected]||0,phase:Y.phase,data:I[f.selected]}):null,f.loading?null:r.a.createElement(Xe,{data:I,cids:j,state:ne,onClick:function(e){var t=n.current.leafletElement;h(Object(s.a)(Object(s.a)({},f),{},{selected:e,prevZoom:t.getZoom()}));var a=z.latLngBounds(I[e].coords).pad(2);t.fitBounds(a)},selected:f.selected})))),t&&"READY"===i?r.a.createElement(B,null):null)}n(835);function ft(){return r.a.createElement(dt,{debug:!0})}function ht(){return r.a.createElement(w,null,r.a.createElement(ft,null))}o.a.render(r.a.createElement(ht,null),document.getElementById("root"))}},[[571,1,2]]]);
//# sourceMappingURL=main.eeb97bbb.chunk.js.map